!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cityMapControl=t():e.cityMapControl=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="http://js.soufunimg.com/industry/citymap/js/",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;var n=toString.call(e);if(n!==toString.call(t))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}if("[object Object]"==n){var i=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(t);if(i.length!=a.length)return!1;for(var o=0;o<i.length;o++){var l=i[o];if(e[l]!==t[l])return!1}return!0}return"[object Array]"==n?e.toString()==t.toString():void 0}function a(){var e={width:0,height:0};return window.innerWidth?e.width=window.innerWidth:document.body&&document.body.clientWidth&&(e.width=document.body.clientWidth),window.innerHeight?e.height=window.innerHeight:document.body&&document.body.clientHeight&&(e.height=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(e.height=document.documentElement.clientHeight,e.width=document.documentElement.clientWidth),e}function o(){}function l(e,t){var n=e,i=t[0];return!(!i||!n)&&("function"==typeof i.contains?i!=n&&i.contains(n):!!(16&i.compareDocumentPosition(n)))}function s(e,t){this.type="select",this.opts={event:"click",data:null,valueColumn:"value",textColumn:"text",seleted:null,textFormatter:null,defautSelectText:null,selectTextFormatter:null,niceScrollStyle:{styler:"fb",cursorcolor:"#aab2bd",cursorwidth:"8",cursorborderradius:"10px",background:"#e6e9ed",spacebarenabled:!1,autohidemode:"leave",cursorborder:"0",zindex:"1000"},eventListener:{click:null,change:function(e){}}},this.container="string"==typeof e?$("#"+e):$(e),this._init(t)}function c(e,t){this.type="multiselect",this.opts={event:"click",data:null,valueColumn:"value",textColumn:"text",seleteds:null,textFormatter:null,selectTextFormatter:null,defautSelectText:null,niceScrollStyle:{styler:"fb",cursorcolor:"#aab2bd",cursorwidth:"8",cursorborderradius:"10px",background:"#e6e9ed",spacebarenabled:!1,autohidemode:"leave",cursorborder:"0",zindex:"1000"},eventListener:{click:null,confirm:function(e,t){},cancel:function(){}}},this.container="string"==typeof e?$("#"+e):$(e),this._init(t)}function r(e,t){this.opts={table:{class:"",attribute:{},style:{}},tr:{class:"",attribute:{},style:{}},th:{class:"",attribute:{},style:{}},td:{class:"",attribute:{},style:{}},columns:[{tvalue:"",text:"",class:{td:"",th:""},attribute:{td:"",th:""}}],data:[]},this.container="string"==typeof e?$("#"+e):$(e),this.init(t)}function d(e){if("string"==typeof e)return e;if("[object Array]"==Object.prototype.toString.call(e))return e.join(" ");if("object"==(void 0===e?"undefined":O(e))){var t="";for(var n in e)t+=" "+n+'="'+e[n]+'" ';return t}}function f(e){var t=e.split(";"),n={};return $.each(t,function(e,t){n[t.split(":")[0]]=t.split(":")[1]}),n}function p(e,t){if(N.length>0)return void("function"==typeof t&&N.push(t));if(F)return void("function"==typeof t?t(F):N&&N.length>0&&N.forEach(function(e){e.init()}));var n=(e.dimensionConfigPath||"http://js.soufunimg.com/industry/citymap/config")+"/"+(e.hasPoint?"":"Single")+"DimensionConfigFile_"+e.cityId+"_"+e.ownerId+".json?v="+(e.jsonVersion||"20171201");$.getJSON(n,function(e){e&&(F={district:[],street:[],board:[]},$.each(e.CityMap_Dimension,function(e,t){switch(t.sType){case"区县":F.district.push(t);break;case"街道":F.street.push(t);break;case"板块":F.board.push(t)}}),F.DimensionRelation=e.CityMap_DimensionRelation,N.forEach(function(e){"function"==typeof e?e(F):e.init()}),N=[],"function"==typeof t&&t(F))})}function u(e,t){var n=this;return n.selArr=[],n.container=e,n.selectDIS="all",n.selectDIM="district",n.areaTypesData=null,n.AreaOption=null,n.eventListener=$.extend(!0,{callback:null,dimensionChange:null,confirm:null,cancel:null},t.eventListener),n.opts=$.extend(!0,{hasPoint:!1,cityId:"",ownerId:"",jsonVersion:"",dimensionConfigPath:"http://js.soufunimg.com/industry/citymap/config",cityName:"",dimensions:[{value:"district",text:"区县"},{value:"board",text:"板块"},{value:"street",text:"街道"}],districtTypes:[],selectds:""},t),t.dimensions&&t.dimensions.length>0&&(n.opts.dimensions=[],$.each(t.dimensions,function(e,t){"district"==t.value&&n.opts.dimensions.push({value:"district",text:"区县",title:t.text}),"board"==t.value&&n.opts.dimensions.push({value:"board",text:"板块",title:t.text}),"street"==t.value&&n.opts.dimensions.push({value:"district",text:"街道",title:t.text})})),delete t.eventListener,F?(n.init(),n):(p({cityId:n.opts.cityId,ownerId:n.opts.ownerId,dimensionConfigPath:n.opts.dimensionConfigPath,jsonVersion:n.opts.jsonVersion,hasPoint:n.opts.hasPoint}),void N.push(this))}function h(e,t){var n=this;return n.selArr=[],n.container=e,n.selectDIS="all",n.selectDIM="district",n.areaTypesData=null,n.AreaOption=null,n.eventListener=$.extend(!0,{change:null,callback:null,dimensionChange:null},t.eventListener),n.opts=$.extend(!0,{type:"multiselect",dimensionConfigPath:"http://js.soufunimg.com/industry/citymap/config",hasPoint:!1,cityId:"",ownerId:"",jsonVersion:"",dimensions:null,all:""},t),n.opts.dimensions=n.opts.dimensions||[{value:"district",text:"区县"},{value:"board",text:"板块"},{value:"street",text:"街道"}],delete t.eventListener,F?(n.init(),n):(p({cityId:n.opts.cityId,ownerId:n.opts.ownerId,dimensionConfigPath:n.opts.dimensionConfigPath,jsonVersion:n.opts.jsonVersion,hasPoint:n.opts.hasPoint}),void N.push(this))}function v(e,t){return q.length>0?void("function"==typeof t&&q.push(t)):z?void("function"==typeof t?t(z):q&&q.length>0&&q.forEach(function(e){e.init()})):void $.getJSON(e.url,function(e){e&&(z=e,q.forEach(function(e){"function"==typeof e?e(z):e.init()}),q=null,"function"==typeof t&&t(z))})}function m(e,t){var n=this;if(n.container=e,n.eventListener=$.extend(!0,{callback:null},t.eventListener),n.opts=$.extend(!0,{url:"/citymap-web/getCityMapPoiTypeDictValue",cityId:"6679b8fe-0231-4c3e-95e2-1afa9e3fea5f",type:null,boardId:null},t),n.opts.type=n.opts.type||[{cateogry:"1",cateogryText:"现状"},{cateogry:"2",cateogryText:"规划"},{cateogry:"3",cateogryText:"未来"}],delete t.eventListener,t.data)z=t.data,n.init();else{if(!z){return v({url:n.opts.url+(n.opts.cityId?"?cityId="+n.opts.cityId:"")+(n.opts.boardId?(n.opts.cityId?"&":"?")+"boardId="+n.opts.boardId:"")}),void q.push(this)}n.init()}}function y(e,t){var n=this;n.container=e,n.eventListener=$.extend(!0,{sectionType:null,sectionQuantity:null,fillStyle:null,fillStyleOpacity:null,strokeStyle:null,strokeStyleOpacity:null,change:null},t.eventListener),delete t.eventListener,n.opts=$.extend(!0,{data:null,isOrder:!1,colorType:"rgb",dimensions:{section:{show:!0,types:null,typeSelected:j.isometry,quantity:[4,10],quantitySelected:4},fillStyle:{show:!0,colors:[],colorsIndex:0,opacity:.7,definedContainer:null},strokeStyle:{show:!0,opacity:.7,color:null}},niceScrollStyle:{styler:"fb",cursorcolor:"#aab2bd",cursorwidth:"8",cursorborderradius:"10px",background:"#e6e9ed",spacebarenabled:!1,autohidemode:"leave",cursorborder:"0",zindex:"1000"}},t),n.opts.dimensions.fillStyle.colors=n.opts.dimensions.fillStyle.colors.concat(M),n.opts.dimensions.strokeStyle.color&&$.inArray(n.opts.dimensions.strokeStyle.color,E)<0?n.opts.dimensions.strokeStyle.colors=[n.opts.dimensions.strokeStyle.color].concat(E):(n.opts.dimensions.strokeStyle.color=n.opts.dimensions.strokeStyle.color||E[0],n.opts.dimensions.strokeStyle.colors=E),n.initialize()}function b(e){e=e||{},this.gradient=e.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=e.maxSize||35,this.minSize=e.minSize||0,this.max=e.max||100,this.initPalette()}function g(e){e=$.extend(!0,{data:null,isOrder:!1,sectionType:j.fenwei.value,min:null,max:null,sectionQuantity:4,colors:[]},e),e._isOrder||e.data.sort(function(e,t){return e-t});var t=[],n={colors:e.colors,min:0,max:e.sectionQuantity,sectionQuantity:e.sectionQuantity};switch(e.sectionType){case j.fenwei.value:t=P.fenwei(e);break;case j.natural.value:t=P.natural(e);break;case j.isometry.value:t=P.isometry(e)}var i=P.getColors(n);return $.each(t,function(e,n){t[e].color=i[e]}),t}function k(e){var t=this;t.bucketTypes=[{value:"naturalbreaks",text:"自然分段",funKey:4},{value:"equalinterval",text:"等距分段",funKey:2},{value:"quantiles",text:"分位法",funKey:3}],t.colors=["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3","#000000","#ffffff"],t.labelSizes=[12,14,16,18,20,22,24],t.markerSizes=[.5,1,2,3,4,5,7,9,11,13,15,20,25,30,35,40],t.bucketCounts=[3,4,5,6,7,8,9],t.labelFonts=[{value:"Microsoft YaHei Regular",text:"雅黑"},{value:"KaiTi Regular",text:"楷体"},{value:"LiSu Regular",text:"隶书"}],t.opacitys=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1],t.outlineWidths=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,2],t.lineWidths=[1,2,3,4,5,6,7,8],t.subSectionType=[];for(var n in j)t.subSectionType.push(j[n]);this.configType={time:[{type:"time",text:"",icon:""}],point:[{type:"marker-icon",text:"图标",icon:"icon-marklable"},{type:"marker-simple",text:"散点图",icon:"icon-Scatter"},{type:"marker-choropleth",text:"点分段",icon:"icon-segment-dot"},{type:"marker-category",text:"点分类",icon:"icon-classify-dot"},{type:"marker-bubble",text:"气泡图",icon:"icon-bubble-chart"},{type:"marker-heat",text:"热力图",icon:"icon-thermograms"}],line:[{type:"polyline-simple",text:"单色渲染",icon:"icon-singleColor"},{type:"polyline-choropleth",text:"分段渲染",icon:"icon-sectRender"},{type:"polyline-category",text:"分类渲染",icon:"icon-sectRender"}],od:[{type:"od",text:"od图",icon:""}],polygon:[{type:"polygon-choropleth",text:"面分段",icon:"icon-segment"},{type:"polygon-category",text:"单值填充",icon:"icon-fill-singleData"},{type:"polygon-simple",text:"单色填充",icon:"icon-fill-singleColor"},{type:"polygon-grid",text:"网格填充",icon:"icon-fill-singleColor"}]}}function x(e,t){function n(){if(i.opts=$.extend(!0,{id:"",type:"polygon",isShow:!0,isCache:!1,title:"面渲染",data:null,index:{types:null,numberTypes:null,bottomColor:"#f1f1f1"},section:{fieldName:c[0]?c[0].value:null,fieldNameSet:c,bucketType:i.bucketTypes[0].value,bucketTypeSet:i.bucketTypes,bucketCount:i.bucketCounts[2],bucketCountSet:i.bucketCounts,classifyIndex:a[0]?a[0].value:null,classifyIndexSet:a,fillColor:8,fillColorSet:e.section&&e.section.fillColorReverse?A:l,fillOpacity:i.opacitys[8],fillOpacitySet:i.opacitys},fill:{show:!0,fillColor:i.colors[0],fillColorSet:i.colors,fillOpacity:i.opacitys[8],fillOpacitySet:i.opacitys},outline:{outlineColor:"#ffffff",outlineColorSet:i.colors,outlineWidth:i.outlineWidths[9],outlineWidthSet:i.outlineWidths,outlineOpacity:i.opacitys[7],outlineOpacitySet:i.opacitys},blendingMode:{show:!0,type:"src-over",typeSet:[{value:"src-over",text:"正常"},{value:"screen",text:"过滤"}]},hrLine:{show:!0},label:{show:!0,labelField:"",labelFieldSet:o,labelSize:i.labelSizes[0],labelSizeSet:i.labelSizes,labelColor:i.colors[0],labelColorSet:i.colors,labelFont:i.labelFonts[0].value,labelFontSet:i.labelFonts},eventListener:{changeIndex:null},callback:null,init:null},e),i._setParam(),i.opts.isCache&&window.localStorage){var t=window.localStorage.getItem("maplayer"+i.opts.id);t=t?JSON.parse(t):null,t&&(t.labelSize&&(i.opts.label.labelSize=t.labelSize),t.labelColor&&(i.opts.label.labelColor=t.labelColor),t.labelFont&&(i.opts.label.labelFont=t.labelFont),t.outlineColor&&(i.opts.outline.outlineColor=t.outlineColor),t.outlineWidth&&(i.opts.outline.outlineWidth=t.outlineWidth),t.outlineOpacity&&(i.opts.outline.outlineOpacity=t.outlineOpacity),t.fillColor&&(i.opts.fill.fillColor=t.fillColor),t.fillOpacity&&(i.opts.fill.fillOpacity=t.fillOpacity),t.fillOpacity&&(i.opts.section.fillOpacity=t.fillOpacity))}return i.init(),i}var i=this;i.dataUid=e.dataUid,i.param=$.extend(!0,{},e),i.box=$(t),i.container=$("#"+e.id);var a=$.extend(!0,[],e.index.types),o=$.extend(!0,[],a);o.unshift({value:"",text:"无"});var l=$.extend(!0,[],M),s=i.judgeGrid(e);if(i.isGrid=s,s){var c=[];$.get(T.host+"/s/data/"+i.dataUid+"/fields?ak="+T.ak,function(e){if(e.data){var t=e.data;i.types=[],$.each(a,function(e,n){$.each(t,function(e,t){n.value==t.name&&(i.types.push(n),"double"!=t.type&&"long"!=t.type&&"integer"!=t.type||(n.dataType="integer"==t.type?"int":"float",c.push(n)))})}),i.numberTypes=c,n()}})}else{var r=i._filterTypes(a,e.data),c=r.numberTypes;i.types=r.types,i.numberTypes=r.numberTypes,n()}}function C(e,t){var n=this;n.param=$.extend(!0,{},e),n.box=$(t),n.container=$("#"+e.id);var i=$.extend(!0,[],e.index.types),a=$.extend(!0,[],i);a.unshift({value:"",text:"无"});var o=n._filterTypes(i,e.data),l=o.numberTypes,s=$.extend(!0,[],M);if(n.types=o.types,n.numberTypes=o.numberTypes,n.opts=$.extend(!0,{id:"",type:"point",isShow:!0,isCache:!1,title:"点渲染",data:null,index:{types:[],numberTypes:null,selected:""},section:{fieldName:l[0]?l[0].value:null,fieldNameSet:l,bucketType:n.bucketTypes[0].value,bucketTypeSet:n.bucketTypes,bucketCount:n.bucketCounts[2],bucketCountSet:n.bucketCounts,classifyIndex:i[0]?i[0].value:null,classifyIndexSet:i,fillColor:8,fillColorSet:e.section&&e.section.fillColorReverse?A:s,fillOpacity:n.opacitys[7],fillOpacitySet:n.opacitys},marker:{show:!0,markerSize:n.markerSizes[2],markerSizeSet:n.markerSizes,markerColor:n.colors[0],markerColorSet:n.colors,markerOpacity:n.opacitys[7],markerOpacitySet:n.opacitys},outline:{show:!0,outlineColor:n.colors[1],outlineColorSet:n.colors,outlineWidth:n.outlineWidths[0],outlineWidthSet:n.outlineWidths,outlineOpacity:n.opacitys[7],outlineOpacitySet:n.opacitys},radius:{minSize:2,minSizeSet:[1,2,3,4,5,6,7,8,9,10,11,12,14,14,15],maxSize:10,maxSizeSet:[6,7,8,10,11,12,13,14,15,16,17,18,19,20],fieldName:l[0]?l[0].value:null,fieldNameSet:l,bucketType:n.bucketTypes[0].value,bucketTypeSet:n.bucketTypes,bucketCount:n.bucketCounts[2],bucketCountSet:n.bucketCounts},heat:{weightField:n.types[0]?n.types[0].value:null,weightFieldSet:n.types,heatSizeUnit:"pixel",heatSize:4,heatSizeUnitSet:[{value:"pixel",text:"像素",unit:"px",configSet:[2,3,4,5,6,7,8,10,12,14,16,18,20],name:"heatPixelSize"},{value:"map",text:"地理",unit:"m",configSet:[100,300,500,700,1e3,1500,2e3,2500,3e3],name:"heatMapSize"}]},hrLine:{show:!0},label:{show:!0,labelField:"",labelFieldSet:a,labelSize:n.labelSizes[0],labelSizeSet:n.labelSizes,labelColor:n.colors[0],labelColorSet:n.colors,labelFont:n.labelFonts[0].value,labelFontSet:n.labelFonts},callback:null},e),n._setParam(),n.opts.isCache&&window.localStorage){var c=window.localStorage.getItem("maplayer"+n.opts.id);c=c?JSON.parse(c):null,c&&(c.labelSize&&(n.opts.label.labelSize=c.labelSize),c.labelColor&&(n.opts.label.labelColor=c.labelColor),c.labelFont&&(n.opts.label.labelFont=c.labelFont),c.outlineColor&&(n.opts.outline.outlineColor=c.outlineColor),c.outlineWidth&&(n.opts.outline.outlineWidth=c.outlineWidth),c.outlineOpacity&&(n.opts.outline.outlineOpacity=c.outlineOpacity),c.fillColor&&(n.opts.fill.fillColor=c.fillColor),c.fillOpacity&&(n.opts.fill.fillOpacity=c.fillOpacity),c.fillOpacity&&(n.opts.section.fillOpacity=c.fillOpacity))}n.init()}function S(e,t){var n=this;n.param=$.extend(!0,{},e),n.box=$(t),n.container=$("#"+e.id);var i=$.extend(!0,[],e.index.types),a=$.extend(!0,[],i);a.unshift({value:"",text:"无"});var o=n._filterTypes(i,e.data),l=o.numberTypes;n.types=o.types,n.numberTypes=o.numberTypes;var s=$.extend(!0,[],M),c=[];for(var r in j)c.push(j[r]);if(n.opts=$.extend(!0,{id:"",type:"line",isShow:!0,isCache:!1,title:"线渲染",data:null,index:{types:[],numberTypes:null,selected:""},section:{fieldName:l[0]?l[0].value:null,fieldNameSet:l,bucketType:n.bucketTypes[0].value,bucketTypeSet:n.bucketTypes,bucketCount:n.bucketCounts[2],bucketCountSet:n.bucketCounts,classifyIndex:i[0]?i[0].value:null,classifyIndexSet:i,fillColor:8,fillColorSet:e.section&&e.section.fillColorReverse?A:s,fillOpacity:n.opacitys[7],fillOpacitySet:n.opacitys},hrLine:{show:!0},label:{show:!0,labelField:"",labelFieldSet:a,labelSize:n.labelSizes[0],labelSizeSet:n.labelSizes,labelColor:n.colors[10],labelColorSet:n.colors,labelFont:n.labelFonts[0].value,labelFontSet:n.labelFonts},line:{lineWidth:n.lineWidths[0],lineWidthSet:n.lineWidths,lineColor:n.colors[0],lineColorSet:n.colors,lineOpacity:n.opacitys[7],lineOpacitySet:n.opacitys},callback:null},e),n._setParam(),n.opts.isCache&&window.localStorage){var d=window.localStorage.getItem("maplayer"+n.opts.id);d=d?JSON.parse(d):null,d&&(d.labelSize&&(n.opts.label.labelSize=d.labelSize),d.labelColor&&(n.opts.label.labelColor=d.labelColor),d.labelFont&&(n.opts.label.labelFont=d.labelFont),d.lineWidth&&(n.opts.line.lineWidth=d.lineWidth),d.lineColor&&(n.opts.line.lineColor=d.lineColor),d.lineOpacity&&(n.opts.line.lineOpacity=d.lineOpacity))}n.init()}function _(e,t){var n=this;n.box=$(t),n.container=$("#"+e.id);var i=$.extend(!0,[],e.index.types),a=n._filterTypes(i,e.data),o=a.numberTypes,l=$.extend(!0,[],M);n.types=a.types,n.numberTypes=a.numberTypes,n.opts=$.extend(!0,{id:"",type:"od",isShow:!0,isCache:!1,title:"OD图",data:null,index:{types:[],numberTypes:null,selected:""},section:{fieldName:o[0]?o[0].value:null,fieldNameSet:o,bucketType:n.bucketTypes[0].value,bucketTypeSet:n.bucketTypes,bucketCount:n.bucketCounts[2],bucketCountSet:n.bucketCounts,classifyIndex:i[0]?i[0].value:null,classifyIndexSet:i,fillColor:8,fillColorSet:e.section&&e.section.fillColorReverse?A:l,fillOpacity:n._fillOpacity?n._fillOpacity:n.opacitys[7],fillOpacitySet:n.opacitys},line:{lineWidth:n.lineWidths[0],lineWidthSet:n.lineWidths,lineColor:n.colors[0],lineColorSet:n.colors,lineOpacity:n.opacitys[7],lineOpacitySet:n.opacitys},od:{curvature:.1,curvatureSet:[.1,.2,.3,.4,.5,.6,.7,.8,.9],symbol:"point",symbolSet:[{value:"arrow",text:"箭头"},{value:"point",text:"圆点"}]},callback:null},e),n.init()}function w(e,t){var n=this;if(n.box=$(t),n.container=$("#"+e.id),n.opts=$.extend(!0,{id:"",type:"time",isShow:!0,isCache:!1,title:"时间轴",time:{topValue:3,topValueSet:[2,3,4,5,6,7,8]},callback:null},e),n.opts.isCache&&window.localStorage){var i=window.localStorage.getItem("maplayer"+n.opts.id);i=i?JSON.parse(i):null,i&&i.topValue&&(n.opts.time.topValue=i.topValue)}n.init()}function D(e,t){var n=this;n.container=$(e),n.opts=$.extend(!0,[],t),n.init(n.opts)}function L(e,t){var n=this;n.container=$(e),n.mapType=t.mapType,n.mapStyle=t.mapStyle,n.eventListener={mapTypeChange:null},n.mapType&&!n.mapStyle&&n.container.find("li[data-mapconfig-maptype="+n.mapType+"]").eq(0).addClass("on"),n.mapType&&n.mapStyle&&n.container.find("li[data-mapconfig-maptype="+n.mapType+"][data-mapconfig-mapstyle="+n.mapStyle+"]").addClass("on"),n.gMaps=[],n.init()}var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T={host:"http://tools.citymap.fang.com",uri:"/s/dataviz/v2/",ak:"ZGE5NDg2OTkzMThhNDE3Mzg0N2I4YjdmNDI2YTAwYTY",tileHost:"http://tools.citymap.fang.com"},I={where:function(e,t,n,i,a){return $.grep(e,function(e){var i="";return i=void 0==n||""==n||null==n?e:e[n],a=a||"==",">"==a?i>t:">="==a?i>=t:"<"==a?i<t:"<="==a?i<=t:"!="==a?i!=t:"indexof"==a.toLowerCase()?i.indexOf(t)>-1:i==t},i)}};Array.prototype.contains=function(e){return I.where(this,e.value,e.column).length>0},Array.prototype.where=function(e){var t=void 0!=e.isNotIn&&e.isNotIn,n=void 0===e.sign?"==":e.sign;return I.where(this,e.value,e.column,t,n)},Array.prototype.whereFirst=function(e){var t="==",n=!1,i="",a="";"object"==O(arguments[0])?(arguments[0].sign&&(t=arguments[0].sign),arguments[0].isNotIn&&(n=arguments[0].isNotIn),arguments[0].value&&(a=arguments[0].value),arguments[0].column&&(i=arguments[0].column)):"string"==typeof arguments[0]&&(i=arguments[0],a=arguments[1],arguments[2]&&(t=arguments[2]));var o=I.where(this,a,i,n,t);return o.length>0?o[0]:{}},Array.prototype.remove=function(e){return I.where(this,e.value,e.column,!0)},Array.prototype.order=function(e,t){var n="desc"==t?-1:1,i=1==n?-1:1;return this.sort(function(t,a){return parseFloat(t[e])==t[e]&&parseFloat(t[e]),parseFloat(a[e])==a[e]&&parseFloat(a[e]),isNaN(parseFloat(t[e]))&&!isNaN(parseFloat(a[e]))?-1==n?1:-1:!isNaN(parseFloat(t[e]))&&isNaN(parseFloat(a[e]))?-1==n?-1:1:parseFloat(t[e])>parseFloat(a[e])?n:i})},Array.prototype.unique=function(e){for(var t=[],n={},i=0;i<this.length;i++){var a=this[i];void 0!==e&&""!=e&&(a=this[i][e]),n[a]||(t.push(this[i]),n[a]=!0)}return t},Array.prototype.mIndexOf=function(e){for(var t=0;t<this.length;t++){var n=this[t];if(void 0!==e.column&&(n=this[t][e.column]),n==e.value)return t}return-1},o.prototype._documentClick=function(e,t,n){var i=this;e="string"==typeof e?$("#"+e):e,t="string"==typeof t?$("#"+t):t,$(document).click(function(a){a=a||window.event;var o=a.target||a.srcElement;l(o,e)||l(o,t)||(t.hide(),e.removeClass("f_select_on"),"function"==typeof n&&n(e),i.cancel&&i.cancel())})},o.prototype.disabled=function(e){if("select"==this.type)var t=$(this.co);else if("multiselect"==this.type)var t=$(this.container.find(".citymapControl-select-SelOpen"));e instanceof Array?$.each(e,function(e,n){t.find('a[citymapControl-select-option-value="'+n+'"]').addClass("ban")}):void 0===e?t.find("a").addClass("ban"):t.find('a[citymapControl-select-option-value="'+e+'"]').addClass("ban")},o.prototype.enabled=function(e){if("select"==this.type)var t=this.co;else if("multiselect"==this.type)var t=this.container.find(".citymapControl-select-SelOpen");e instanceof Array?$.each(e,function(e,n){t.find('a[citymapControl-select-option-value="'+n+'"]').removeClass("ban")}):void 0===e?t.find("a").removeClass("ban"):t.find('a[citymapControl-select-option-value="'+e+'"]').removeClass("ban")},o.prototype.destroy=function(){this.container.html("")},o.prototype.setData=function(e){this.opts.data=e,this._init()},o.prototype.reset=function(){this._coClickEvent(this.history)},o.prototype.val=function(e){var t=this;if("undefind"==typeof e)return this.nowObj;if("multiselect"==this.type){var n=[];e instanceof Array?$.each(this.opts.data,function(i,a){$.each(e,function(e,i){a[t.opts.valueColumn]==i&&n.push(a)})}):$.each(this.opts.data,function(i,a){a[t.opts.valueColumn]==e&&n.push(a)}),this._coClickEvent(n)}else if("select"==this.type){var i={};$.each(this.opts.data,function(n,a){a[t.opts.valueColumn]==e&&(i=a)}),this._coClickEvent(i)}},o.prototype._init=function(e){this.opts=$.extend(!0,this.opts,e),this.opts.valueColumn||(this.opts.valueColumn="value"),this.opts.textColumn||(this.opts.textColumn="text");var t=this;this.history=null,this.nowObj=null,this.opts.data&&this._changeData(),this.to=t.container.find(".citymapControl-select-title"),this.co=t.container.find(".citymapControl-select-option"),this._toClick(),"select"==this.type?this.val(this.opts.seleted):"multiselect"==this.type&&this.val(this.opts.seleteds),"multiselect"==this.type?this.container&&(this.container.find(".citymapControl-select-option"),this._documentClick(this.to,this.co)):this._documentClick(this.to,this.co),this.co.addClass("nice-scroll")},o.prototype._toClick=function(){var e=this;"click"==this.opts.event?this.to.off(this.opts.event).on(this.opts.event,function(t){"none"==e.co.css("display")?(e.to.addClass("f_select_on"),e.co.fadeIn("normal")):(e.to.removeClass("f_select_on"),e.co.fadeOut("normal")),e._coClick(),"function"==typeof e.opts.eventListener.click&&e.opts.eventListener.click(e.to,e.co),e.container.find(".nice-scroll").getNiceScroll().resize()}):"mouseover"==this.opts.event&&this.to.off(this.opts.event).on(this.opts.event,function(t){"none"==e.co.css("display")&&(e.to.addClass("f_select_on"),e.co.fadeIn("normal")),e._coClick(),"function"==typeof e.opts.eventListener.click&&e.opts.eventListener.click(e.to,e.co),e.container.find(".nice-scroll").getNiceScroll().resize()})},s.prototype=new o,s.prototype._changeData=function(){var e=this,t='<div class="citymapControl-select-title form_select clearfix">\n                            <span class="sel_text fl">'+(this.opts.defautSelectText||"请选择")+'</span>\n                            <em class="fr icon_caret01"></em>\n                       </div>\n                       <div class ="citymapControl-select-option form_option" style="display:none;">\n                       </div>';this.container.html(t);var n='<div class="chbh nice-scroll" style="max-height:200px;">';$.each(e.opts.data,function(t,i){var a=e.opts.textColumn?i[e.opts.textColumn]:i.text;"function"==typeof e.opts.textFormatter&&((a=e.opts.textFormatter(i))||(a=e.opts.textColumn?i[e.opts.textColumn]:i.text));var o=e.opts.valueColumn?i[e.opts.valueColumn]:i.value,l=e.opts.textColumn?i[e.opts.textColumn]:i.text;n+='<a href="javascript:;" class="f_optionbox clearfix p08" citymapControl-select-option-value="'+o+'"  citymapControl-select-option-ttext="'+l+'">'+a+"</a>"}),n+="</div>",this.container.find(".citymapControl-select-option").html(n),this.container.find(".nice-scroll").niceScroll(this.opts.niceScrollStyle)},s.prototype._coClick=function(){var e=this;this.co.off("click").on("click","a",function(){if(!$(this).hasClass("ban")){var t={},n=$(this);$.each(e.opts.data,function(i,a){a[e.opts.valueColumn]==n.attr("citymapControl-select-option-value")&&(t=a)}),e._coClickEvent(t)}})},s.prototype._coClickEvent=function(e){this.co.hide(),this.to.removeClass("f_select_on"),this.nowObj=this.nowObj?this.nowObj:{},e[this.opts.valueColumn]!=this.nowObj[this.opts.valueColumn]&&(null==this.history?this.history=e:this.history=this.nowObj,this.nowObj=e,this._execu_Event(e))},s.prototype._execu_Event=function(e){var t=this.co.find('a[citymapControl-select-option-value="'+e[this.opts.valueColumn]+'"]'),n=$(t).text();this.opts.eventListener.change(e,t);var i=n;"function"==typeof this.opts.selectTextFormatter&&(i=this.opts.selectTextFormatter(t)),this.container.find(".citymapControl-select-title span").text(i).attr("title",i)},s.prototype.change=function(){this._execu_Event(this.nowObj)},c.prototype=new o,c.prototype._changeData=function(){var e=this,t='<div class="form_select clearfix citymapControl-select-title">\n                        <span class ="sel_text fl"> '+(e.opts.defautSelectText||"请选择")+' </span>\n                        <em class="fr icon_caret01"></em>\n                    </div>\n                    <div class ="form_option citymapControl-select-option" style="display:none;">\n                        <div class ="nice-scroll citymapControl-select-SelOpen" style="max-height: 200px;">\n                        </div>\n                        <div class ="butbox clearfix">\n                            <span class ="blue02 citymapControl-select-allClick" style="cursor:pointer;">全选</span>\n                            &nbsp;|&nbsp;\n                            <span class ="blue02 citymapControl-select-allUnclick" style="cursor:pointer;">反选</span>\n                            <a href="javascript:;" class ="but_cancel fr citymapControl-select-cancel">取消</a>\n                            <a href="javascript:;" class ="but_confirm fr mr05 citymapControl-select-save">确定</a>\n                        </div>\n                    </div>';this.container.html(t);var n='<div class="chbh" >';$.each(e.opts.data,function(t,i){var a=e.opts.textColumn?i[e.opts.textColumn]:i.text;"function"==typeof e.opts.textFormatter&&((a=e.opts.textFormatter(i))||(a=e.opts.textColumn?i[e.opts.textColumn]:i.text));var o=e.opts.valueColumn?i[e.opts.valueColumn]:i.value,l=e.opts.textColumn?i[e.opts.textColumn]:i.text;n+='<a href="javascript:;" class="f_optionbox clearfix" citymapControl-select-option-value="'+o+'"  citymapControl-select-option-ttext="'+l+'"><em name="check" class="check '+(i.isChecked?"checked":"")+'"></em>'+a+"</a>"}),n+="</div>",this.container.find(".citymapControl-select-SelOpen").html(n),this.container.find(".nice-scroll").niceScroll(this.opts.niceScrollStyle)},c.prototype._coClick=function(){var e=this;this._choose(),this.container.find(".citymapControl-select-save").unbind("click").click(function(){e._confirm()}),this.container.find(".citymapControl-select-cancel").unbind("click").click(function(){e.cancel()}),this.co.find(".citymapControl-select-SelOpen").off("click").on("click","a",function(){$(this).hasClass("ban")||$(this).find("em").toggleClass("checked")})},c.prototype._confirm=function(){var e=this,t=[];this.container.find(".citymapControl-select-SelOpen").find("a em.checked").each(function(n,i){$.each(e.opts.data,function(n,a){a[e.opts.valueColumn]==$(i).parent().attr("citymapControl-select-option-value")&&t.push(a)})}),this._coClickEvent(t)},c.prototype._coClickEvent=function(e){var t=this;if(e=e||[],this.co.hide(),this.to.removeClass("f_select_on"),this.nowObj=this.nowObj?this.nowObj:[],e.length==this.nowObj.length){var n=!1;if($.each(e,function(e,a){$.each(t.nowObj,function(e,t){i(a,t)&&(n=!0)})}),n)return}null==this.history?this.history=e:this.history=this.nowObj,this.nowObj=e,this._execu_Event(e,!0)},c.prototype._execu_Event=function(e,t){var n=this;this.container.find(".citymapControl-select-SelOpen").find("a em").removeClass("checked");var i="";$.each(e,function(e,t){n.container.find(".citymapControl-select-SelOpen").find("a[citymapControl-select-option-value='"+t[n.opts.valueColumn]+"'] em").addClass("checked"),i+=n.container.find(".citymapControl-select-SelOpen").find("a[citymapControl-select-option-value='"+t[n.opts.valueColumn]+"']").text()+","});var a=i.substring(0,i.length-1);"function"==typeof this.opts.selectTextFormatter&&(a=this.opts.selectTextFormatter(e)),this.container.find(".citymapControl-select-title span").text(a).attr("title",a),t&&this.opts.eventListener.confirm(e,n.container.find(".citymapControl-select-SelOpen").find("a .checked").parent())},c.prototype.cancel=function(){var e=this;e.container.find(".citymapControl-select-option").hide(),e.to.removeClass("f_select_on"),"function"==typeof e.opts.eventListener.cancel&&e.opts.eventListener.cancel(),e.container.find(".citymapControl-select-SelOpen em").removeClass("checked"),this.nowObj=this.nowObj?this.nowObj:[],$.each(this.nowObj,function(t,n){e.container.find(".citymapControl-select-SelOpen").find("a[citymapControl-select-option-value='"+n[e.opts.valueColumn]+"'] em").addClass("checked")})},c.prototype.confirm=function(){this._execu_Event(this.nowObj,!0)},c.prototype._choose=function(){var e=this;this.container.find(".citymapControl-select-allClick").unbind("click").click(function(){e.container.find(".citymapControl-select-SelOpen em.check").addClass("checked")}),this.container.find(".citymapControl-select-allUnclick").unbind("click").click(function(){e.container.find(".citymapControl-select-SelOpen em.check").toggleClass("checked")})},c.prototype.checkAll=function(){var e=this;this.container.find(".citymapControl-select-SelOpen em.check").addClass("checked"),this.nowObj=[],$.each(this.opts.data,function(t,n){e.container.find(".citymapControl-select-SelOpen em.checked").each(function(t,i){n[e.opts.valueColumn]==$(i).parent().attr("citymapControl-select-option-value")&&e.nowObj.push(n)})}),this._execu_Event(this.nowObj,!1)},c.prototype.unCheck=function(){var e=this;this.container.find(".citymapControl-select-SelOpen em.check").toggleClass("checked"),this.nowObj=[],$.each(this.opts.data,function(t,n){e.container.find(".citymapControl-select-SelOpen em.checked").each(function(t,i){n[e.opts.valueColumn]==$(i).parent().attr("citymapControl-select-option-value")&&e.nowObj.push(n)})}),this._execu_Event(this.nowObj,!1)},r.prototype.init=function(e){this.opts=$.extend(!0,this.opts,e),this._createTable(),this._addStyle(),this._addTrEvent(),this._addTdEvent(),this._addThEvent(),this._addColEvent()},r.prototype._createTable=function(){var e=this;this.str='<table class="'+this.opts.table.class+'" '+d(this.opts.table.attribute)+'><thead><tr class="'+this.opts.tr.class+'" '+d(this.opts.tr.attribute)+">",$.each(this.opts.columns,function(t,n){if("function"==typeof n.text){n.text()}else{n.text}e.str+='<th class="'+e.opts.th.class+"  "+n.class.th+'"  '+d(e.opts.th.attribute)+" "+d(n.attribute.th)+' tvalue="'+n.tvalue+'"  >'+n.text+"</th>"}),this.str+="</tr></thead><tbody>",$.each(this.opts.data,function(t,n){var i='<tr class="'+e.opts.tr.class+'"  '+d(e.opts.tr.attribute)+">";$.each(e.opts.columns,function(t,i){var a=n[i.tvalue];e.str+='<td class="'+e.opts.td.class+"  "+i.class.td+'"  '+d(e.opts.td.attribute)+" "+d(i.attribute.td)+'  tvalue="'+i.tvalue+'">'+a+"</td>"}),i+="</tr>",e.str+=i}),this.str+="</tbody></table>",this.container.html(this.str)},r.prototype._addStyle=function(){"object"==O(this.opts.table.style)?this.container.find("table").css(this.opts.table.style):"string"==typeof this.opts.table.style&&this.container.find("table").css(f(this.opts.table.style)),"object"==O(this.opts.tr.style)?this.container.find("tr").css(this.opts.tr.style):"string"==typeof this.opts.tr.style&&this.container.find("tr").css(f(this.opts.tr.style)),"object"==O(this.opts.td.style)?this.container.find("td").css(this.opts.td.style):"string"==typeof this.opts.td.style&&this.container.find("td").css(f(this.opts.td.style)),"object"==O(this.opts.th.style)?this.container.find("th").css(this.opts.th.style):"string"==typeof this.opts.th.style&&this.container.find("th").css(f(this.opts.th.style))},r.prototype._addTrEvent=function(){var e=this;if("object"==O(this.opts.tr.eventListener))for(var t in this.opts.tr.eventListener)e.container.find("table").on(t,"tr",function(n){e.opts.tr.eventListener[t](this),n.stopPropagation()})},r.prototype._addTdEvent=function(){var e=this;if("object"==O(this.opts.td.eventListener))for(var t in this.opts.td.eventListener)e.container.find("table").on(t,"td",function(n){e.opts.td.eventListener[t](this),n.stopPropagation()})},r.prototype._addThEvent=function(){var e=this;if("object"==O(this.opts.th.eventListener))for(var t in this.opts.th.eventListener)e.container.find("table").on(t,"th",function(n){e.opts.th.eventListener[t](this),n.stopPropagation()})},r.prototype._addColEvent=function(e){var t=this;$.each(this.opts.columns,function(e,n){if("object"==O(n.eventListener)&&"object"==O(n.eventListener.th))for(var i in n.eventListener.th)t.container.find("table").on(i,"th[tvalue="+n.tvalue+"]",function(e){n.eventListener.th[i](this),e.stopPropagation()});if("object"==O(n.eventListener)&&"object"==O(n.eventListener.td))for(var i in n.eventListener.td)t.container.find("table").on(i,"td[tvalue="+n.tvalue+"]",function(e){n.eventListener.td[i](this),e.stopPropagation()})})},r.prototype.resetDate=function(e){this.opts.data=e,this.init(this.opts)};var F=void 0,N=[];u.prototype={_judgeType:function(){var e=this;$.each(e.opts.dimensions,function(t,n){0==e.data[n.value].length&&e.opts.dimensions.splice(t,1)})},_initData:function(){var e=this;e.data=$.extend(!0,{},F),e.relationData=$.extend(!0,[],F.DimensionRelation),$.each(e.data.district,function(t,n){delete n.sPoints;var i=e.relationData.where({value:n.sID,column:"sDimensionID"});n.board=$.map(i.where({value:"板块",column:"sChildType"}),function(t){var n=$.extend(!0,{},e.data.board.whereFirst({value:t.sChildDimensionID,column:"sID"}));if(n)return delete n.sPoints,n}),n.street=$.map(i.where({value:"街道",column:"sChildType"}),function(t){var n=$.extend(!0,{},e.data.street.whereFirst({value:t.sChildDimensionID,column:"sID"}));if(n)return delete n.sPoints,n})}),e.opts.districtTypes.length>0&&$.each(e.opts.districtTypes,function(t,n){var i=[];$.each(n.config,function(t,n){$.each(e.data.district,function(e,t){n==t.sName&&i.push(t)})}),e.data["district"+t]=i})},_createDistrict:function(e,t,n){var i=this,a="";$(i.container).find("."+e+"UL").empty(),$.each(t,function(e,n){e%2==0?(a+='<li class="">',a+='<a href="javascript:;" name="check" title='+n.sName+'><input type="hidden" value='+n.sName+" tid="+n.sObjID+" sid="+n.sID+'><em class ="check"></em>'+n.sName+"</a>",e==t.length-1&&(a+="</li>")):(a+='<a href="javascript:;" name="check" title='+n.sName+'><input type="hidden" value='+n.sName+" tid="+n.sObjID+" sid="+n.sID+'><em class ="check"></em>'+n.sName+"</a>",a+="</li>")}),$(i.container).find("."+e+"UL").append(a),void 0!=n&&n.length>0&&$.each(n,function(t,n){$.each($(i.container).find("."+e+"UL").find("a"),function(e,t){$(i.container).find(t).find("input").attr("tid")==n&&$(i.container).find(t).find("em").addClass("checked")})})},_createArea:function(e,t,n){var i=this;if("district"!=e){var a=i.opts.dimensions.where({value:e,column:"value"})[0].text;$(i.container).find("."+e+"Content").empty();var o='<div class="sub-cnt-list"  >';if($.each(t,function(t,n){o+=' <dl class="no-margin " ttype="'+e+'" tname="'+n.sObjID+'">                          <dt class="clearfix">                              <span class="col_white fl">'+n.sName+a+'</span>                              <span class="fr blue02"><span style="cursor:pointer;" name="selectall" pvalue="'+n.sName+'" ptype="'+e+'">全选</span>&nbsp;|&nbsp;<span style="cursor:pointer;" name="cancelall" pvalue="'+n.sName+'" ptype="'+e+'">反选</span></span>                          </dt>                          <dd class="clearfix">                           ',$.each(n[e],function(t,i){o+='<a href="javascript:;" title="'+i.sName+'" name="checksel" pvalue="'+n.sName+'" ptype="'+e+'"><input type="hidden" value="'+i.sName+'" tid="'+i.sObjID+'" sid="'+i.sID+'"/><em class="check"></em>'+i.sName+"</a>"}),o+="</dd>                      </dl>"}),o+="</div>",$(i.container).find("."+e+"Content").html(o),void 0!=n){$.each($(i.container).find("."+e+"Content").find("dl"),function(e,t){$(i.container).find(t).hide()});var l=1;$.each($(i.container).find("."+e+"Content").find("dl"),function(t,n){$.each($(i.container).find("."+e+"UL").find("a"),function(e,t){$(i.container).find(t).find("input").attr("tid")==$(i.container).find(n).attr("tname")&&(l<=2&&$(i.container).find(n).show(),l++)})}),n.length>0&&$.each(n,function(t,n){$.each($(i.container).find("."+e+"Content").find("dl"),function(t,a){$.each($(i.container).find("."+e+"UL").find("a"),function(e,t){$(i.container).find(a).attr("tname")==n&&$(i.container).find(t).find("input").attr("tid")==n&&$(i.container).find(a).find("em").addClass("checked")})})})}}},_createHtml:function(){var e=this;$(e.container).find(".help-districtarea-select span").text("城市:"+e.opts.cityName);var t="";$.each(e.opts.dimensions,function(e,n){t+="<li ttype="+n.value+" class="+(0==e?"active":"")+'><a href="javascript:;" data-toggle="tab">'+n.text+' <em class="iconbox icon_caret03"></em></a></li>'}),$(e.container).find(".typeswitch").html(t);var n="";$.each(e.opts.districtTypes,function(e,t){n+='<a href="javascript:;" class="ml05" name='+t.name+" key="+e+">"+t.name+"</a>"}),$(e.container).find(".all").append(n)},_judgeCheck:function(e){var t=this,n=$(t.container),i=n.find("."+e+"Content"),a=n.find("."+e+"UL");$.each(i.find("dl"),function(e,t){var n=$(t).attr("tname"),i=a.find("input[type='hidden'][sid='"+n+"']").next();0==$(t).find("em.check").length?i.removeClass("sm-checked").addClass("checked"):0==$(t).find("em.checked").length?i.removeClass("checked").removeClass("sm-checked"):$(t).find("em.checked").length==$(t).find("em.check").length?i.removeClass("sm-checked").addClass("checked"):i.removeClass("checked").addClass("sm-checked")})},_bindEvent:function(){var e=this,t=$(e.container),n=$(e.container).find(".districtAreaOption");$(e.container).find(".districtAreaSel").unbind("click").click(function(){if($(e.container).find(".districtAreaOption div[name='content']").hide(),"none"==$(e.container).find(".districtAreaOption").css("display")){$(e.container).find(this).removeClass("f_select_on").addClass("f_select_on"),n.show(),$(e.container).find(".districtAreaOption .nice-scroll").getNiceScroll().resize();var t=e.selectDIM;$(e.container).find(".typeswitch li[ttype="+t+"]").click(),$(e.container).find("."+t+"UL").find("em").removeClass("sm-checked").removeClass("checked"),$(e.container).find("."+t+"Content").find("em").removeClass("checked"),e.selArr.length>0&&($.each(e.selArr,function(n,i){"district"==t?$(e.container).find("."+t+"UL").find("input[tid='"+i+"']").eq(0).next().addClass("checked"):$(e.container).find("."+t+"Content").find("dl[tname='"+i.districtId+"']").find("input[tid='"+i.id+"']").next().addClass("checked")}),e._judgeCheck(t))}else $(this).removeClass("f_select_on"),n.hide()}),$(e.container).find(".typeswitch li").unbind("click").click(function(){var t=$(this).attr("ttype");if(e.selectDIM=t,$(this).addClass("active").siblings().removeClass("active"),$(e.container).find("."+t+"UL").show().siblings().hide(),"function"==typeof e.eventListener.dimensionChange){var n=e.opts.dimensions.where({value:t,column:"value"})[0];e.eventListener.dimensionChange(n)}}),0==e.opts.districtTypes.length?$(e.container).find(".selectallcity").mousemove(function(){}).unbind("click").click(function(){var t={};e.selectDIS="all",$(e.container).find(".districtAreaSel span").text("城市："+e.opts.cityName).removeAttr("title"),t.sReturnValue="",t.sReturnType="city",t.sReturnSID="",t.sReturnName="",e.selArr=new Array,n.hide(),"function"==typeof e.eventListener.confirm&&e.eventListener.confirm(t),$.each(e.opts.dimensions,function(t,n){$(e.container).find("."+n.value+"UL").find("em").removeClass("checked").removeClass("sm-checked"),$(e.container).find("."+n.value+"Content").find("em").removeClass("checked").removeClass("sm-checked")})}):$(e.container).find(".selectallcity").parent().on("click","a",function(){var t;if($(this).text(),$(this).addClass("but_confirm").siblings("a").removeClass("but_confirm"),$(this).hasClass("selectallcity"))e.selectDIS="all",t=e.data.district;else{var n=$(this).attr("key");e.selectDIS=n,t=e.data["district"+n]}if($.grep(e.opts.dimensions,function(e){return"district"==e.value}).length>0){var i=[];$.each($(e.container).find(".districtUL").find("a"),function(t,n){if(1==$(e.container).find(n).find("em").hasClass("checked")){var a=$(e.container).find(n).find("input").attr("tid");i.push(a)}}),e._createDistrict("district",t,i)}if($.grep(e.opts.dimensions,function(e){return"board"==e.value}).length>0){var a=[];$.each($(e.container).find(".boardUL").find("a"),function(t,n){if(1==$(e.container).find(n).find("em").hasClass("checked")){var i=$(e.container).find(n).find("input").attr("tid");a.push(i)}}),e._createDistrict("board",t,a),e._createArea("board",t,a),e._bindAreaEvent("board")}if($.grep(e.opts.dimensions,function(e){return"street"==e.value}).length>0){var o=[];$.each($(e.container).find(".streetUL").find("a"),function(t,n){if(1==$(e.container).find(n).find("em").hasClass("checked")){var i=$(e.container).find(n).find("input").attr("tid");o.push(i)}}),e._createDistrict("street",t,o),e._createArea("street",t,o),e._bindAreaEvent("street")}}),$(e.container).on("click","div[class=tab-content] a[name=check]",function(){var t=$(this).parent().parent().attr("ttype");if($(this).find("em").attr("class").indexOf("checked")>-1){if($(this).find("em").removeClass("sm-checked").removeClass("checked"),"district"==t)return;$(e.container).find("."+t+"Content").find("dl[ttype='"+t+"'][tname='"+$(this).find("input[type='hidden']").attr("tid")+"']").find("a em").removeClass("checked")}else{if($(this).find("em").addClass("checked"),"district"==t)return;$(e.container).find("."+t+"Content").find("dl[ttype='"+t+"'][tname='"+$(this).find("input[type='hidden']").attr("tid")+"']").find("a em").removeClass("checked").addClass("checked")}}),$(e.container).find(".districtAreaOption").on("mouseover","div[class=tab-content] ul li",function(){var t=$.map($(this).find("input[type='hidden']"),function(e,t){return $(e).attr("tid")}),n=$(this).parent().attr("ttype");$("."+n+"UL").find("li").removeClass("active"),$(this).addClass("active"),$(e.container).find(".districtAreaOption div[name='content']").hide(),$(e.container).find("."+n+"Content").show().find("dl").hide(),$.each(t,function(t,i){"none"!=$(e.container).find(".districtUL").find("a").find("input[tid="+i+"]").parent().css("display")&&$(e.container).find("."+n+"Content").find("dl[tname='"+i+"']").show()}),e._bindAreaEvent(n),$(e.container).find(".districtAreaOption .nice-scroll").getNiceScroll().resize()}),$(e.container).find(".operatecontent span[name='checkalldistrict']").unbind("click").click(function(){var t=$(e.container).find(".typeswitch li.active").attr("ttype");$(e.container).find("."+t+"Content").find("em").removeClass("checked").removeClass("sm-checked").addClass("checked"),$(e.container).find("."+t+"UL").find("em").removeClass("checked").removeClass("sm-checked").addClass("checked")}),t.find(".operatecontent span[name='cancelalldistrict']").unbind("click").click(function(){var t=$(e.container).find(".typeswitch li.active").attr("ttype"),n=$(e.container).find("."+t+"UL").find("em.checked"),i=$(e.container).find("."+t+"Content").find("em.checked");$(e.container).find("."+t+"UL").find("em").removeClass("checked").removeClass("sm-checked").addClass("checked"),$(e.container).find("."+t+"Content").find("em").removeClass("checked").removeClass("sm-checked").addClass("checked"),$(e.container).find(n).removeClass("checked"),$(e.container).find(i).removeClass("checked").removeClass("sm-checked")}),$(e.container).find(".operatecontent a[tname='cancel']").unbind("click").click(function(){$(e.container).find(".districtAreaSel").removeClass("f_select_on"),$(e.container).find(".districtAreaOption").hide(),"function"==typeof e.eventListener.cancel&&e.eventListener.cancel()}),t.find(".operatecontent a[tname='sure']").unbind("click").click(function(n){var i=$(e.container).find(".typeswitch li.active").attr("ttype"),a={},o="",l=null;if(l="district"==i?$(e.container).find("."+i+"UL").find("em.checked"):$(e.container).find("."+i+"Content").find("em.checked"),0==l.length)return a.dimensionType=i,a.data="",a.id="",a.isall=!1,e.AreaOption=a,$(e.container).find(".districtAreaSel span").text("城市："+e.opts.cityName).removeAttr("title"),n.originalEvent&&"function"==typeof e.eventListener.confirm&&e.eventListener.confirm(a),e.selArr=[],void $(e.container).find(".districtAreaOption").hide();a.data=$.map(l,function(e,t){return{id:$(e).prev().attr("sid"),name:$(e).prev().attr("value")}}),e.selArr="district"==i?$.map(l,function(e,t){return $(e).prev().attr("sid")}):$.map(l,function(e,t){return{id:$(e).prev().attr("sid"),districtId:$(e).parents("dl").eq(0).attr("tname")}}),o=a.data=$.map(l,function(e,t){return $(e).prev().attr("value")}).join(",");var s=$.map(l,function(e,t){return $(e).prev().attr("sid")});a.id=s.join(","),a.dimensionType=i,a.isall=t.find("."+i+"UL").find("em.checked").length==t.find("."+i+"UL").find("em.check").length,a.sReturnName=o,e.AreaOption=a;var c=e.opts.dimensions.where({value:i,column:"value"})[0];t.find(".districtAreaSel span").text((c.title?c.title:c.text)+"："+o).attr("title",o),t.find(".districtAreaSel").removeClass("f_select_on"),t.find(".districtAreaOption").hide();var r=$(e.container).find(".districtAreaOption div.tab-content ul[ttype!='"+i+"']");$.each(r,function(t,n){var i=$(n).attr("ttype");$(e.container).find("."+i+"UL").find("li em").removeClass("checked").removeClass("sm-checked"),$(e.container).find("."+i+"Content").find("dl em").removeClass("checked")}),n.originalEvent&&"function"==typeof e.eventListener.confirm&&e.eventListener.confirm(a)})},_bindAreaEvent:function(e){var t=this,n=$(t.container).find("."+e+"UL"),i=$(t.container).find("."+e+"Content");i.mousemove(function(){var e=$(this).find("dl:visible");if(e.length>0){var t=$(e).eq(0).find("a[name='checksel']").eq(0).attr("pvalue");n.find("li").removeClass("active"),n.find("input[type='hidden'][value='"+t+"']").parent().parent().removeClass("active").addClass("active")}}),i.find("a[name='checksel']").unbind("click").click(function(){var e=$(this).parents("dd").eq(0),t=($(this).attr("ptype"),$(this).attr("pvalue"));$(this).find("em").hasClass("checked")?($(this).find("em").removeClass("checked"),0==e.find("em.checked").length?n.find("input[type='hidden'][value='"+t+"']").next().removeClass("sm-checked").removeClass("checked"):i.find(" a[name='checksel'][pvalue='"+t+"'] em.checked").length<i.find(" a[name='checksel'][pvalue='"+t+"']").length&&n.find("input[type='hidden'][value='"+t+"']").next().removeClass("sm-checked").removeClass("checked").addClass("sm-checked")):($(this).find("em").addClass("checked"),n.find("input[type='hidden'][value='"+t+"']").next().removeClass("sm-checked").removeClass("checked").addClass("sm-checked"),e.find("em.checked").length==e.find("em.check").length?n.find("input[type='hidden'][value='"+t+"']").next().removeClass("sm-checked").addClass("checked"):n.find("input[type='hidden'][value='"+t+"']").next().removeClass("checked").addClass("sm-checked"))}),i.find("span[name='selectall']").unbind("click").click(function(){var e=($(this).attr("ptype"),$(this).attr("pvalue"));$(this).parent().parent().next().find("em").removeClass("checked").addClass("checked"),n.find("input[type='hidden'][value='"+e+"']").next().removeClass("sm-checked").removeClass("checked").addClass("checked")}),i.find("span[name='cancelall']").unbind("click").click(function(){var e=$(this).parent().parent().next().find("em.checked");$(this).parent().parent().next().find("a[name='checksel'] em").removeClass("checked").addClass("checked"),$(e).removeClass("checked");var t=$(this).attr("ptype"),a=$(this).attr("pvalue");$(this).parent().parent().next().find("a[name='checksel'] em.checked").length>0?(n.find("input[type='hidden'][value='"+a+"']").next().removeClass("sm-checked").removeClass("checked").addClass("sm-checked"),i.find(" a[name='checksel'][pvalue='"+a+"'] em.checked").length==$("#"+t+"Content").find(" a[name='checksel'][pvalue='"+a+"']").length?n.find("input[type='hidden'][value='"+a+"']").next().removeClass("sm-checked").removeClass("checked").addClass("checked"):n.find("input[type='hidden'][value='"+a+"']").next().removeClass("sm-checked").removeClass("checked").addClass("sm-checked")):n.find("input[type='hidden'][value='"+a+"']").next().removeClass("sm-checked").removeClass("checked")}),i.find("a.but_confirm").unbind("click").click(function(){})},_getData:function(){var e,t=this,n=$(t.container),i=n.find(".typeswitch li.active").attr("ttype"),a={dimensionType:i,data:[]},o=[];e="district"==i?n.find("."+i+"UL").find("em.checked").siblings("input"):n.find("."+i+"Content").find("em.checked").siblings("input"),$.each(e,function(e,t){o.push({name:$(t).attr("value"),id:$(t).attr("sid")})});var l=o.map(function(e){return e.name}),s=o.map(function(e){return e.id});return a.isall=n.find("."+i+"UL").find("em.checked").length==n.find("."+i+"UL").find("em.check").length,a.name=0==l.length?"":l.join(","),a.id=0==s.length?"":s.join(","),a.data=o,a}},u.prototype.init=function(){var e=this;e._initData(),e._judgeType(),$(e.container).html('<div class="form_select clearfix help-districtarea-select districtAreaSel"><span class="sel_text fl"></span><em class="fr icon_caret01"></em></div>    <div class ="form_option help-districtarea-options districtAreaOption" style="min-width: 170px;display:none;" >       <div>           <div class ="all p10"><a href="javascript:;" class ="selectallcity but_confirm">全市</a></div>           <ul class="nav nav-tabs nav-tabs-n01 typeswitch"></ul>           <div class="tab-content">                <ul class="areaL no-padding no-margin nice-scroll districtUL"  ttype="district" style="min-height:220px;max-height:220px;overflow: scroll; outline: none;"></ul>                <ul class="areaL no-padding no-margin nice-scroll boardUL"   ttype="board" style="min-height:220px;max-height:220px;overflow: scroll; outline: none;display:none;"></ul>                <ul class="areaL no-padding no-margin nice-scroll streetUL"   ttype="street" style="min-height:220px;max-height:220px;overflow: scroll; outline: none;display:none;"></ul>                <div class="sub-content nice-scroll boardContent" style="display:none;" id="boardContent" name="content">                </div>                <div class="sub-content nice-scroll streetContent" style="display:none;" id="streetContent" name="content">                </div>            </div>       </div>       <div class ="butbox clearfix operatecontent" style="">            <span class ="blue02 help-districtarea-checkall" name="checkalldistrict" style="cursor:pointer;">全选</span>            <span class ="blue02 help-districtarea-uncheck">&nbsp; |&nbsp; </span>            <span class ="blue02 help-districtarea-uncheck" name="cancelalldistrict" style="cursor:pointer;">反选</span>            <a href="javascript:;" class ="but_cancel fr help-districtarea-cancel" tname="cancel">取消</a>            <a href="javascript:;" class ="but_confirm fr mr05 help-districtarea-sure" tname="sure">确定</a>        </div>    </div>'.replace("{cityName}",e.opts.cityName)),e._createHtml();var t=$.extend(!0,[],e.data.district);$.each(e.opts.dimensions,function(n,i){"district"==i.value?e._createDistrict("district",t):(e._createDistrict(i.value,t),e._createArea(i.value,t))}),e._bindEvent(),"function"==typeof e.eventListener.userRevise&&e.eventListener.userRevise(e),e.opts.dimensions&&1==e.opts.dimensions.length&&$(e.container).find("."+e.opts.dimensions[0].value+"UL").show().siblings(".areaL").hide(),$(".districtAreaOption .nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"}),e.opts.all?($(e.container).find(".typeswitch li[ttype="+e.opts.all+"]").click(),$(e.container).find("[name=checkalldistrict]").click(),$(e.container).find("[tname=sure]").click()):$(e.container).find("[tname=sure]").click(),"function"==typeof e.eventListener.callback&&e.eventListener.callback(e,e.AreaOption)},u.prototype.val=function(e,t){var n=this;if(!e)return n.AreaOption;var i="all"==n.selectDIS?n.data.district:n.data["district"+n.selectDIS],a=e.split(",");t=t||n.selectDIM,n.selectDIM=t,"district"==t?n._createDistrict("district",i,a):(n._createDistrict(t,i,a),n._createArea(t,i,a),n._bindAreaEvent(t)),$(n.container).find(".typeswitch [ttype="+t+"]").click()},u.prototype.change=function(e){this.eventListener[e]},u.prototype.dimensionChange=function(e){var t=this;"function"==typeof t.eventListener.dimensionChange&&(e=e||t.selectDIM,$(t.container).find(".typeswitch li[ttype="+e+"]").click())},u.prototype.confirm=function(){var e=this;"function"==typeof e.eventListener.confirm&&$(e.container).find(".operatecontent a[tname='sure']").click()},u.prototype.cancel=function(){var e=this;"function"==typeof e.eventListener.cancel&&$(e.container).find(".operatecontent a[tname='cancel']").click()},h.prototype={_judgeType:function(){var e=this,t=[];$.each(e.opts.dimensions,function(n,i){e.data[i.value].length>0&&t.push(i)}),e.opts.dimensions=t},_initData:function(){var e=this;e.data=$.extend(!0,{},F),e.relationData=$.extend(!0,[],F.DimensionRelation),$.each(e.data.district,function(t,n){delete n.sPoints;var i=e.relationData.where({value:n.sID,column:"sDimensionID"});n.board=$.map(i.where({value:"板块",column:"sChildType"}),function(t){var i=$.extend(!0,{districtName:n.sName,districtId:n.sID},e.data.board.whereFirst({value:t.sChildDimensionID,column:"sID"}));if(i)return delete i.sPoints,i}),0==n.board.length&&(n.isBoardNull=!0),n.street=$.map(i.where({value:"街道",column:"sChildType"}),function(t){var i=$.extend(!0,{districtName:n.sName,districtId:n.sID},e.data.street.whereFirst({value:t.sChildDimensionID,column:"sID"}));if(i)return delete i.sPoints,i}),0==n.street.length&&(n.isStreetNull=!0)})},_showBasisDom:function(){var e=this,t=$(e.container);if(t.html('<div class="panel sf_panel">        <div class="panel-head clearfix">            <h3 class="fl panel-head-title"><span>区域选择</span></h3>            <div class="stat-tab fl ml10">            </div>            <a href="javascript:;" class="fr but-collap"></a>        </div>        <div class="panel-body">            <div class="form-row clearfix mt05" style="border-botttom:1px solid #ccc;display:none">                <div class="fl gray6 form-label">关注地</div>                <div class="focus-city fl"><span></span><em class="icon-focus-more"></em></div>            </div>            <ul class="nav nav-tabs nav-tabs-n01 typeswitch">            </ul>            <div class="tab-content clearfix">                <ul class="areaL no-padding no-margin districtUL nice-scroll" type="district" style="overflow: hidden; outline: none;"></ul>                <ul class="areaL no-padding no-margin boardUL nice-scroll" style="display:none;overflow: hidden; outline: none;" type="board"></ul>                <ul class="areaL no-padding no-margin streetUL nice-scroll" style="display:none;overflow: hidden; outline: none;" type="street"></ul>            </div>            <div class ="butbox clearfix operatecontent" style="">                <span class ="blue01 all-checkall" name="checkalldistrict" style="cursor:pointer;">全选</span>                <span class ="blue01">&nbsp; |&nbsp; </span>                <span class ="blue01 all-cancelall" name="cancelalldistrict" style="cursor:pointer;">反选</span>           </div>    </div></div>'.replace("{cityName}",e.opts.cityName)),e.opts.dimensions.length>0){var n="";$.each(e.opts.dimensions,function(e,i){n+="<li ttype="+i.value+" class="+(0==e?"active":"")+'><a href="javascript:;" data-toggle="tab">'+i.text+"</a></li>",0==e&&t.find("."+i.value+"UL").show()}),t.find(".typeswitch").html(n)}1==e.opts.dimensions.length&&t.find(".typeswitch li").hide()},_createDistrictDom:function(e,t){var n=this,i=$(n.container),a="",o="all"==n.selectDIS?n.data.district:n.data["district"+n.selectDIS];if(i.find("."+e+"UL").empty(),"district"==e)$.each(o,function(t,n){t%3==0?(a+='<li class="clearfix" type='+e+'><div class="tabbox clearfix">',a+='<a href="javascript:;" name='+n.sName+" title="+n.sName+" title="+n.sName+" sid="+n.sID+'><em class ="check"></em><span>'+n.sName+"</span></a>",t==o.length-1&&(a+="</div></li>")):(a+='<a href="javascript:;" name='+n.sName+" title="+n.sName+" sid="+n.sID+'><em class ="check"></em><span>'+n.sName+"</span></a>",t%3==2&&(a+="</div></li>"))});else{var l=0;$.each(o,function(t,n){"board"==e&&n.isBoardNull||"street"==e&&n.isStreetNull||(l++,l%3==1?(a+='<li class="clearfix" type='+e+'><div class="tabbox clearfix">',a+='<a href="javascript:;" name='+n.sName+" title="+n.sName+" title="+n.sName+" sid="+n.sID+'><em class ="check"></em><span>'+n.sName+"</span></a>",t==o.length-1&&(a+="</div></li>")):(a+='<a href="javascript:;" name='+n.sName+" title="+n.sName+" sid="+n.sID+'><em class ="check"></em><span>'+n.sName+"</span></a>",l%3==0&&(a+="</div></li>")))})}i.find("."+e+"UL").html(a),i.find(".nice-scroll").getNiceScroll().resize(),void 0!=t&&t.length>0&&$.each(t,function(t,n){$.each(i.find("."+e+"UL").find(".tabbox a"),function(e,t){$(t).attr("sid")==n&&$(t).find("em").addClass("checked")})})},_createAreaDom:function(e,t){var n=this,i=$(n.container);if("district"!=e){var a=n.opts.dimensions.where({value:e,column:"value"})[0].text;$.each(n.data.district,function(t,n){var o=' <div class="sub-content" style="display:none;"  type="'+e+'" p_id="'+n.sObjID+'">                                <div class="sub-cnt-list nice-scroll" style="overflow: hidden; outline: none;">                  <dl class="clearfix">\t                          <dd class="clearfix">\t                           ',l=[];$.each(n[e],function(t,n){l.indexOf(n.sID)>-1||(l.push(n.sID),o+='<a href="javascript:;" name="checksel" value="'+n.sName+'" title="'+n.sName+'" type="'+e+'" sid='+n.sID+' districtName="'+n.districtName+'" districtId="'+n.districtId+'"><em class="check"></em>'+n.sName+"</a>")}),o+='</dd>\t                      <dt class="clearfix">                                  <span class="col_white fl">'+n.sName+a+'</span>                                  <span class="fr blue01"><span style="cursor:pointer;" name="selectall" pvalue="'+n.sName+'" ptype="'+e+'">全选</span>&nbsp;|&nbsp;<span style="cursor:pointer;" name="cancelall" pvalue="'+n.sName+'" ptype="'+e+'">反选</span></span>                              </dt></dl></div></div>',i.find("."+e+"UL").find("a[name="+n.sName+"]").parent().after(o)}),void 0!=t&&t.length>0&&$.each(t,function(t,n){$.each(i.find("."+e+"UL").find(".sub-content"),function(e,t){var i=$(t).parents("li").find(".tabbox").find("a[name='"+name+"'] em");$.each($(t).find("li a"),function(e,t){$(t).attr("sid")==n&&$(t).find("em").addClass("checked")});var a=$(t).find("em.checked");a.length==$(t).find("em.check")?i.addClass("checked"):a.length>0&&i.addClass("sm-checked")})})}},_bindEvent:function(){var e=this,t=$(e.container);t.find(".typeswitch li").unbind("click").click(function(){var n=$(this).attr("ttype"),i=t.find(".typeswitch li.active").attr("ttype");if(t.find("."+i+"UL").find(".sub-content").hide(),t.find("."+i+"UL").find(".tabbox a").removeClass("on"),$(this).addClass("active").siblings().removeClass("active"),t.find("."+n+"UL").show().siblings().hide(),e.selectDIM=n,e._bindAreaEvent(n),"function"==typeof e.eventListener.dimensionChange){var a=e.opts.dimensions.where({value:n,column:"value"})[0];e.eventListener.dimensionChange(a)}}),t.find(".areaL .tabbox span").unbind("click").click(function(){var n=$(this),i=n.parents("ul").eq(0),a=n.siblings("em"),o=i.attr("type"),l=n.parent("a").attr("sid"),s=n.parents("li").eq(0).find(".sub-content[type="+o+"][p_id="+l+"]");if("district"==o)return void(a.hasClass("checked")?a.removeClass("checked"):a.addClass("checked"));"block"==s.css("display")?(s.hide(),a.parent().removeClass("on")):(i.find(".sub-content").hide(),s.show(),t.find(".areaL .tabbox a").removeClass("on"),a.parent().addClass("on"),t.find(".nice-scroll").getNiceScroll().resize(),t.parents(".nice-scroll").getNiceScroll().resize(),e._bindAreaEvent(o))}),t.find(".areaL .tabbox em").unbind("click").click(function(){var e=$(this),n=e.parents("ul").eq(0),i=n.attr("type"),a=e.parent("a").attr("sid"),o=e.parents("li").find(".sub-content[type="+i+"][p_id="+a+"]");if(e.attr("class").indexOf("checked")>-1){if(e.removeClass("checked").removeClass("sm-checked"),"district"==i)return;o.find("a em").removeClass("checked")}else{if(e.addClass("checked"),"district"==i)return;n.find(".sub-content").hide(),e.parent().removeClass("on"),o.find("a em").addClass("checked"),t.find(".nice-scroll").getNiceScroll().resize(),t.parents(".nice-scroll").getNiceScroll().resize()}}),t.find(".all-checkall").unbind("click").click(function(){var n=e.selectDIM,i=t.find("."+n+"UL").find("li .tabbox em"),a=t.find("."+n+"UL").find("li .sub-content em");"district"==n?i.addClass("checked"):(i.removeClass("sm-checked").addClass("checked"),a.addClass("checked"))}),t.find(".all-cancelall").unbind("click").click(function(){var n=e.selectDIM,i=t.find("."+n+"UL"),a=i.find("li .tabbox em"),o=i.find("li .tabbox em.checked"),l=i.find("li .tabbox em.sm-checked"),s=i.find("li .sub-content em"),c=i.find("li .sub-content em.checked");"district"==n?(a.addClass("checked"),o.removeClass("checked")):(a.addClass("checked"),o.removeClass("checked"),l.removeClass("checked"),s.addClass("checked"),c.removeClass("checked"))})},_bindAreaEvent:function(e){var t=this,n=$(t.container).find("."+e+"UL");n.find("a[name='checksel']").unbind("click").click(function(){var e=$(this),t=e.parents("dl").eq(0),n=($(this).attr("type"),$(this).parents(".sub-content").eq(0).attr("p_id")),i=e.parents("li").eq(0).find(".tabbox").find("a[sid='"+n+"'] em");$(this).find("em").attr("class").indexOf("checked")>-1?($(this).find("em").removeClass("checked"),0==t.find("em.checked").length?i.removeClass("sm-checked").removeClass("checked"):i.removeClass("checked").addClass("sm-checked")):(e.find("em").addClass("checked"),t.find("em.checked").length==t.find("em.check").length?i.removeClass("sm-checked").addClass("checked"):i.removeClass("checked").addClass("sm-checked"))}),n.find("span[name='selectall']").unbind("click").click(function(){var e=$(this),t=e.parents(".sub-content").eq(0),n=t.attr("p_id"),i=e.parents("li").eq(0).find(".tabbox").find("a[sid='"+n+"'] em");t.find("em").addClass("checked"),i.removeClass("sm-checked").addClass("checked")}),n.find("span[name='cancelall']").unbind("click").click(function(){var e=$(this),t=e.parents(".sub-content").eq(0),n=t.find("em.checked"),i=t.attr("p_id"),a=e.parents("li").eq(0).find(".tabbox").find("a[sid='"+i+"'] em");t.find("em").addClass("checked"),t.find(n).removeClass("checked"),t.find("em.checked").length==t.find("em.check").length?a.removeClass("sm-checked").addClass("checked"):0==t.find("em.checked").length?a.removeClass("checked").removeClass("sm-checked"):a.removeClass("checked").addClass("sm-checked")})},_selectMode:function(){var e=this,t=$(e.container);t.find(".areaL em").hide(),t.find("dt").hide(),t.find(".operatecontent").hide(),t.find(".form-row").show(),t.find(".tab-content>ul").addClass("form-bk"),t.find(".typeswitch li").unbind("click").click(function(){var e=$(this),n=e.attr("ttype");e.addClass("active").siblings().removeClass("active"),t.find("."+n+"UL").show().siblings().hide().find(".sub-content").hide()}),t.find(".tabbox a").unbind("click").click(function(){var n=$(this),i=n.attr("sid"),a=n.attr("name"),o=n.attr("districtid"),l=n.attr("districtname"),s=t.find(".typeswitch li.active").attr("ttype"),c=n.parent().siblings("[p_id="+i+"]");if("district"==s)t.find(".areaL a.on").removeClass("on"),n.addClass("on"),t.find(".form-row .focus-city span").text(a).attr("sid",i).attr("type",s),t.find(".typeswitch,.tab-content").hide(),e._selectData&&e._selectData.id==i||(e._selectData={name:a,id:i,districtId:o,districtName:l},"function"==typeof e.eventListener.change&&e.eventListener.change({name:a,id:i,districtId:o,districtName:l}));else{n.parents(".areaL").eq(0).find(".tabbox a").removeClass("on"),n.addClass("on");var r=c.css("display");t.find("."+s+"UL").find(".sub-content").hide(),"block"==r?c.hide():c.show()}t.parents(".nice-scroll").getNiceScroll().resize()}),t.find(".sub-content a").unbind("click").click(function(){var n=$(this),i=n.attr("sid"),a=n.attr("value"),o=n.attr("districtid"),l=n.attr("districtname");t.find(".sub-content a.on").removeClass("on"),t.find(".tabbox a.on").removeClass("on"),n.addClass("on").parents(".sub-content").eq(0).siblings(".tabbox").find("a[sid="+o+"]").addClass("on"),t.find(".form-row .focus-city span").text(a).attr("sid",i).attr("type",n.attr("type")).attr("districtid",o),t.find(".typeswitch,.tab-content").hide(),e._selectData&&e._selectData.id==i||(e._selectData={name:a,id:i,districtId:o,districtName:l},"function"==typeof e.eventListener.change&&e.eventListener.change({name:a,id:i,districtId:o,districtName:l}))}),t.find(".form-row .icon-focus-more").unbind("click").click(function(){var e=$(this),n=e.siblings("span"),i=n.attr("sid"),a=n.attr("type");if(n.text())if("block"==t.find(".tab-content").css("display"))t.find(".typeswitch ,.tab-content").hide();else if(t.find(".typeswitch ,.tab-content").show(),t.find("."+a+"UL").show().siblings().hide(),t.find(".typeswitch li[ttype="+a+"]").addClass("active").siblings().removeClass("active"),"district"==a)t.find("."+a+"UL").find("a.on").removeClass("on"),t.find("."+a+"UL").find("a[sid="+i+"]").addClass("on");else{var o=n.attr("districtid");t.find("."+a+"UL").find("a.on").removeClass("on"),t.find("."+a+"UL").find(".sub-content").hide(),t.find("."+a+"UL").find(".tabbox").find("a[sid="+o+"]").addClass("on"),t.find("."+a+"UL").find(".sub-content[p_id="+o+"]").show().find("a[sid="+i+"]").addClass("on")}})},_getData:function(){var e=this,t=$(e.container),n=t.find(".typeswitch li.active").attr("ttype"),i=t.find("."+n+"UL"),a=i.find(".tabbox em.checked").parent("a"),o=i.find(".sub-content em.checked").parent("a"),l={dimensionType:n,data:[]},s=[];"district"==n?$.each(a,function(e,t){s.push({name:$(t).attr("name"),id:$(t).attr("sid")})}):$.each(o,function(e,t){s.push({name:$(t).attr("value"),id:$(t).attr("sid"),districtId:$(t).attr("districtid"),districtName:$(t).attr("districtname")})}),l.isall=i.find(".tabbox em.checked").length==i.find(".tabbox em.check").length;var c=s.map(function(e){return e.name}),r=s.map(function(e){return e.id});return l.name=0==c.length?"":c.join(","),l.id=0==r.length?"":r.join(","),l.data=s,l}},h.prototype.init=function(){var e=this,t=$(e.container);if(e._initData(),e._judgeType(),e._showBasisDom(),$.each(e.opts.dimensions,function(t,n){var i=n.value;"district"==i?e._createDistrictDom(i):(e._createDistrictDom(i),e._createAreaDom(i))}),"select"==e.opts.type?e._selectMode():e._bindEvent(),$(".districtAreaOption .nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"}),e.opts.all&&"select"!=e.opts.type){var n=t.find(".typeswitch li[ttype="+e.opts.all+"]");if(n.length>0&&(n.click(),t.find(".butbox .all-checkall").click(),"function"==typeof e.eventListener.callback))return void e.eventListener.callback(e._getData())}"function"==typeof e.eventListener.callback&&e.eventListener.callback(e)},h.prototype.val=function(e,t){var n=this,i=("all"==n.selectDIS?n.data.district:n.data["district"+n.selectDIS],e);if(!e)return"select"==n.opts.type?n._selectData:n._getData();if("select"==n.opts.type)return n._selectData;if("multiselect"==n.opts.type){if(!e)return n._getData();t=t||n.selectDIM,n.selectDIM=t,"district"==t?n._createDistrictDom("district",i):(n._createDistrictDom(t,i),n._createAreaDom(t,i)),$(n.container).find(".typeswitch [ttype="+t+"]").click()}},h.prototype.dimensionChange=function(e){var t=this;"function"==typeof t.eventListener.dimensionChange&&(e=e||t.selectDIM,$(t.container).find(".typeswitch li[ttype="+e+"]").click())};var z=void 0,q=[];m.prototype={_judgeType:function(){var e=this,t=[];$.each(e.opts.type,function(n,i){e.data[i.cateogry]&&t.push(i)}),e.opts.type=t},_renderDom:function(){var e=this,t=$(e.container);if(e.opts.type.length>0){var n="";$.each(e.opts.type,function(i,a){n+='<a href="javascript:;" key='+a.cateogry+" class="+(0==i?"on":"")+">"+a.cateogryText+"</a>";var o=0==i?'<div class="panel-inner-body" key='+a.cateogry+">":'<div class="panel-inner-body" key="'+a.cateogry+'" style="display:none">';$.each(e.data[a.cateogry],function(e,t){o+='<div class="form-row clearfix mt05">\n                                        <div class="fl form-labels form-labels-wid01"><a href="javascript:;" typeId="'+t.typeId+'">'+t.name+"</a></div>",t.childs&&t.childs.length>0&&(o+='<div class="form-select-content fl form-select-wid"><ul class="selection-list">',$.each(t.childs,function(e,t){if(t.tags&&t.tags.length>1){var n=0;$.each(t.tags,function(e,i){e>0&&i.tagName==t.tags[e-1].tagName||n++}),o+='<li class="" typeId="'+t.typeId+'" name="'+t.name+'"><a href="javascript:;" class="a-option">'+t.name+'(<span class="num">0</span>/'+n+")</a>"}else o+='<li class="" typeId="'+t.typeId+'" name="'+t.name+'"><a href="javascript:;" class="a-option">'+t.name+"</a>";t.tags&&t.tags.length>1&&(o+='<div class="submenu-selection" style="display:none;">',$.each(t.tags,function(e,n){e>0&&n.tagName==t.tags[e-1].tagName?o+='<a href="javascript:;" class="f_optionbox" style="display:none" title="'+n.tagName+'"><em class="check" tagId="'+n.tagId+'" tagName="'+n.tagName+'"></em>'+n.tagName+"</a>":o+='<a href="javascript:;" class="f_optionbox" title="'+n.tagName+'"><em class="check" tagId="'+n.tagId+'" tagName="'+n.tagName+'"></em>'+n.tagName+"</a>"}),o+="</div>"),o+="</li>"}),o+="</ul></div>"),o+="</div>"}),o+='<div class="butbox form-butbox clearfix mt05">\n                                                    <a href="javascript:;" class="but_confirm fr">清空选择</a>\n                                                </div></div>',t.find(".panel-body").append(o)}),t.find(".stat-tab").html(n)}},_listenClick:function(){this.eventListener.listenClick&&"function"==typeof this.eventListener.listenClick&&this.eventListener.listenClick(this,this.val())},_bindEvent:function(){var e=this,t=$(e.container);t.find(".stat-tab a").unbind("click").click(function(){var e=$(this).attr("key");$(this).addClass("on").siblings().removeClass("on"),t.find(".panel-inner-body[key="+e+"]").show().siblings(".panel-inner-body").hide()}),t.find(".selection-list li").unbind("click").click(function(){var t=($(this).attr("key"),$(this).find(".submenu-selection"));if(t.length>0){t.find("em.checked").length==t.find("em.check").length?$(this).removeClass("on").find("em.checked").removeClass("checked"):$(this).addClass("on").find("em").addClass("checked");var n=$.map($(this).find(".f_optionbox"),function(e){if("block"==$(e).css("display")&&$(e).find("em.checked").length>0)return e});$(this).find(".num").text(n.length)}else $(this).hasClass("on")?$(this).removeClass("on"):$(this).addClass("on");e._listenClick()}),t.find(".selection-list li").unbind("hover").hover(function(){var e=$(this).find(".submenu-selection");e.length>0&&e.show()},function(){var e=$(this).find(".submenu-selection");e.length>0&&e.hide()}),t.find(".f_optionbox").unbind("click").click(function(t){var n=$(this),i=n.parent().parent(),a=i.find(".num"),o=n.find("em"),l=o.attr("tagname");!o.hasClass("checked")?(o.addClass("checked"),n.siblings("[title="+l+"]").find("em").addClass("checked"),i.addClass("on")):(o.removeClass("checked"),n.siblings("[title="+l+"]").find("em").removeClass("checked"),0==i.find("em.checked").length&&i.removeClass("on"));var s=$.map(i.find(".f_optionbox"),function(e){if("block"==$(e).css("display")&&$(e).find("em.checked").length>0)return e});a.text(s.length),e._listenClick(),t.stopPropagation()}),t.find(".form-labels-wid01 a").unbind("click").click(function(){var t=$(this),n=t.parent().siblings(),i=n.find("em.checked");if(i.length==n.find("em.check").length&&n.find("li").length==n.find("li.on").length)i.removeClass("checked"),n.find("li").removeClass("on").find(".num").text("0");else{n.find("li").addClass("on").find("em").addClass("checked");var a=n.find("li");$.each(a,function(e,t){var n=$.map($(t).find(".f_optionbox"),function(e){if("block"==$(e).css("display")&&$(e).find("em.checked").length>0)return e});$(t).find(".num").text(n.length)})}e._listenClick()}),t.find(".but_confirm").unbind("click").click(function(){var e=$(this),t=e.parents(".panel-body").eq(0);t.find("li.on").removeClass("on").find(".submenu-selection").hide(),t.find("em.checked").removeClass("checked"),t.find(".num").text("0")})}},m.prototype.init=function(){var e=this;$(e.container).html('<div class="panel sf_panel">                                <div class="panel-head clearfix">                                    <h3 class="fl panel-head-title"><span>数据选择</span></h3>                                    <div class="stat-tab fl ml10">                                    </div>                                    <a href="javascript:;" class="fr but-collap"></a>                                </div>                                <div class="panel-body"></div>                            </div>'),e.data=$.extend(!0,{},z),e._judgeType(),e._renderDom(),e._bindEvent(),"function"==typeof e.eventListener.callback&&e.eventListener.callback(e)},m.prototype.val=function(e,t){var n=this,i=$(n.container),a=i.find(".stat-tab a.on").attr("key");t=t||a;var o=i.find(".panel-inner-body[key="+t+"]");if(!e){var l=[];return $.each(o.find("li.on"),function(e,t){var n=$(t).find("em.checked").length==$(t).find("em.check").length,i={name:$(t).attr("name"),typeId:$(t).attr("typeId"),tags:[],checkall:n};$(t).find("em.checked").length>0&&$.each($(t).find("em.checked"),function(e,t){i.tags.push({tagId:$(t).attr("tagId"),tagName:$(t).attr("tagName")})}),l.push(i)}),l}$.each(e,function(e,t){var n=o.find("li[typeId="+t.typeId+"]");t.typeId&&n.addClass("on"),t.tags&&t.tags.length>0&&($.each(t.tags,function(e,t){n.find("em[tagId="+t.tagId+"]").addClass("checked")}),n.find(".num").text(n.find("em.checked").length))})},m.prototype.typeChange=function(e){var t=this;$(t.container).find(".stat-tab a[key="+e+"]").click()};var j={isometry:{text:"等距分段",value:2},fenwei:{text:"分位法",value:3},natural:{text:"自然分段",value:4}},M=[["rgba(0,176,80,1)","rgba(255,255,255,1)"],["rgba(0,112,192,1)","rgba(255,255,255,1)"],["rgba(192,0,0,1)","rgba(255,255,255,1)"],["rgba(255,192,0,1)","rgba(255,255,255,1)"],["rgba(214,47,39,1)","rgba(235,180,112,1)","rgba(255,255,191,1)","rgba(116,214,160,1)","rgba(91,199,199,1)","rgba(69,117,181,1)"],["rgba(12,15,120,1)","rgba(173,240,65,1)","rgba(92,227,25,1)","rgba(15,209,44,1)","rgba(24,184,155,1)","rgba(25,137,168,1)","rgba(255,255,127,1)"],["rgba(255,34,0,1)","rgba(255,179,0,1)","rgba(255,255,0,1)","rgba(166,217,0,1)","rgba(68,163,0,1)","rgba(0,97,0,1)"],["rgba(70,32,150,1)","rgba(161,201,96,1)","rgba(209,227,139,1)","rgba(255,255,191,1)","rgba(165,232,146,1)","rgba(116,214,148,1)","rgba(80,182,191,1)","rgba(48,62,166,1)","rgba(77,32,150,1)"],["rgba(253,80,30,1)","rgba(252,132,38,1)","rgba(251,183,50,1)","rgba(254,216,151,1)","rgba(255,233,199,1)","rgba(208,227,241,1)","rgba(132,194,231,1)","rgba(35,151,208,1)","rgba(17,117,182,1)","rgba(29,68,127,1)"],["rgba(221,36,58,0.8)","rgba(238,97,97,0.8)","rgba(247,137,99,0.8)","rgba(253,181,123,0.8)","rgba(255,245,204,0.8)","rgba(205,232,242,0.8)","rgba(178,211,232,0.8)","rgba(107,174,214,0.8)","rgba(50,130,190,0.8)","rgba(28,79,145,0.8)"],["rgba(235,74,64,0.8)","rgba(241,120,85,0.8)","rgba(245,158,114,0.8)","rgba(249,192,153,0.8)","rgba(253,224,197,0.8)","rgba(205,232,242,0.8)","rgba(178,211,232,0.8)","rgba(107,174,214,0.8)","rgba(50,130,190,0.8)","rgba(28,79,145,0.8)"]],A=[["rgba(255,255,255,1)","rgba(0,176,80,1)"],["rgba(255,255,255,1)","rgba(0,112,192,1)"],["rgba(255,255,255,1)","rgba(192,0,0,1)"],["rgba(255,255,255,1)","rgba(255,192,0,1)"],["rgba(69,117,181,1)","rgba(91,199,199,1)","rgba(116,214,160,1)","rgba(255,255,191,1)","rgba(235,180,112,1)","rgba(214,47,39,1)"],["rgba(255,255,127,1)","rgba(25,137,168,1)","rgba(24,184,155,1)","rgba(15,209,44,1)","rgba(92,227,25,1)","rgba(173,240,65,1)","rgba(12,15,120,1)"],["rgba(0,97,0,1)","rgba(68,163,0,1)","rgba(166,217,0,1)","rgba(255,255,0,1)","rgba(255,179,0,1)","rgba(255,34,0,1)"],["rgba(77,32,150,1)","rgba(48,62,166,1)","rgba(80,182,191,1)","rgba(116,214,148,1)","rgba(165,232,146,1)","rgba(255,255,191,1)","rgba(209,227,139,1)","rgba(161,201,96,1)","rgba(70,32,150,1)"],["rgba(29,68,127,1)","rgba(17,117,182,1)","rgba(35,151,208,1)","rgba(132,194,231,1)","rgba(208,227,241,1)","rgba(255,233,199,1)","rgba(254,216,151,1)","rgba(251,183,50,1)","rgba(252,132,38,1)","rgba(253,80,30,1)"]],E=["rgba(0,0,0,1)","rgba(152,240,254,1)","rgba(255,255,255,1)","rgba(153,164,175,1)","rgba(0,176,80,1)","rgba(0, 112, 192,1)","rgba(192, 0, 0,1)","rgba(112, 48, 160,1)","rgba(255, 192, 0,1)","rgba(86, 255, 160,1)","rgba(95, 186, 255,1)","rgba(255, 105, 98,1)","rgba(180, 93, 255,1)","rgba(255, 214, 119,1)","rgba(0, 179, 186,1)","rgba(5, 0, 197,1)","rgba(162, 104, 102,1)","rgba(252, 54, 199,1)","rgba(255, 106, 16,1)"];y.prototype={},y.prototype.initialize=function(){var e=this,t=0,n=0;if(["section","fillStyle","strokeStyle"].forEach(function(n){e.opts.dimensions[n].show&&t++}),e.opts.dimensions.section.show&&(e.container.append('<div class="form-row clearfix mt10">                    <div class="pull-left form-label">选择分段：</div>                    <div class="form-input pull-left mr05 help-section-type" style="width:100px;z-index:118;">                    </div>                    <div class="form-input pull-left mr05 help-section-count" style="width:80px;z-index:118;">                    </div>                </div>'),e.sectionTypeSel=new s($(".help-section-type"),{event:"click",data:function(e){var t=[];for(var n in e)t.push({value:e[n].value,text:e[n].text});return t}(e.opts.dimensions.section.types||j),seleted:e.opts.dimensions.section.sectionType||j.fenwei.value,eventListener:{change:function(i,a){e.eventListener.sectionType!=i.value&&(e.eventListener.sectionType=i.value,e.eventListener.change&&t==n&&e.change("change"))}}}),e.sectionCountSel=new s($(".help-section-count"),{event:"click",data:function(e,t){for(var n=[],i=e;i<=t;i++)n.push({value:i,text:i});return n}(e.opts.dimensions.section.quantity[0],e.opts.dimensions.section.quantity[1]),seleted:e.opts.dimensions.section.quantitySelected?e.opts.dimensions.section.quantitySelected>e.opts.dimensions.section.quantity[0]||e.opts.dimensions.section.quantitySelected<e.opts.dimensions.section.quantity[1]?e.opts.dimensions.section.quantity[0]:e.opts.dimensions.section.quantitySelected:e.opts.dimensions.section.quantity[0],eventListener:{change:function(i,a){e.eventListener.sectionQuantity!=i.value&&(e.eventListener.sectionQuantity=i.value,e.eventListener.change&&t==n&&e.change("change"))}}}),n++),e.opts.dimensions.fillStyle.show){e.container.append('<div class="form-row clearfix mt10">                    <div class="pull-left form-label">填充色值：</div>                    <div class="form-input pull-left help-section-fillcolor">                        <div class="colorPicker"></div>\t\t\t\t\t    <div class="col_suspend posleft" style="display:none">\t\t\t\t\t\t    <div class="nice-scroll" style="max-height: 150px;">\t\t\t\t\t\t\t    <div class="color-list p10">\t\t\t\t\t\t\t\t    <ul class="clearfix">\t\t\t\t\t\t\t\t    </ul>\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t    </div>\t\t\t\t\t\t    </div>\t\t\t\t\t\t</div>                    <div class="pull-left form-label ml10" style="width:60px;">透明度：</div>                    <div class="form-input pull-left mr05 help-fillstyle-opacity" style="width:60px;z-index:117;">                    </div>                    <a href="javascript:;" class="blue_0 text-under pull-left ml05 help-btnDefineColor">自定义</a>                </div>');var i=e.container.find(".help-section-fillcolor .colorPicker");e.eventListener.fillStyle=e.opts.dimensions.fillStyle.colors[e.opts.dimensions.fillStyle.colorsIndex],i.css("background","rgba(0, 0, 0, 0) linear-gradient(to right, "+$.map(e.opts.dimensions.fillStyle.colors[e.opts.dimensions.fillStyle.colorsIndex],function(e){return e}).join(",")+" 100%) repeat scroll 0 0");var o="";$.each(e.opts.dimensions.fillStyle.colors,function(e,t){o+='<li style="background: rgba(0, 0, 0, 0) linear-gradient(to right, '+function(e){return $.map(e,function(e){return e}).join(",")}(t)+' 100%) repeat scroll 0 0;"></li>'}),e.container.find(".help-section-fillcolor ul").html(o).find("li").unbind("click").click(function(){var i=$(this).index();e.container.find(".help-section-fillcolor .colorPicker").next().hide();var a=e.opts.dimensions.fillStyle.colors[i];e.container.find(".help-section-fillcolor .colorPicker").css("background","rgba(0, 0, 0, 0) linear-gradient(to right, "+function(e){return $.map(e,function(e){return e}).join(",")}(a)+" 100%) repeat scroll 0 0"),e.eventListener.fillStyle!=a&&($.each(a,function(t,n){a[t]=n.substring(0,n.lastIndexOf(",")+1)+e.eventListener.fillStyleOpacity+")"}),e.eventListener.fillStyle=a,e.legendArr&&$.each(e.legendArr,function(t,n){e.legendArr[t].color=e.eventListener.fillStyle[t]}),e.eventListener.change&&t==n&&e.eventListener.change(e.legendArr))}),i.unbind("click").click(function(){var t=$(this).next();if("none"==t.css("display")){var n=i.offset(),o=i.parent().height(),l=a(),s=t.height();n.top+o+s>l.height?t.hasClass("posbot")||t.addClass("posbot"):t.hasClass("posbot")&&t.removeClass("posbot"),t.show();var c=e.container.find(".help-section-fillcolor .nice-scroll");c.getNiceScroll().length>0?c.getNiceScroll().resize():c.niceScroll(e.opts.niceScrollStyle)}else t.hide()}),e.fillStyleOpacitySel=new s($(".help-fillstyle-opacity"),{event:"click",data:function(){for(var e=[],t=0;t<=1;t+=.1)e.push({value:t.toFixed(1),text:t.toFixed(1)});return e}(),seleted:e.opts.dimensions.fillStyle.opacity,eventListener:{change:function(i,a){e.eventListener.fillStyleOpacity!=i.value&&(e.eventListener.fillStyleOpacity=i.value,$.each(e.eventListener.fillStyle,function(t,n){e.eventListener.fillStyle[t]=n.substring(0,n.lastIndexOf(",")+1)+e.eventListener.fillStyleOpacity+")"}),e.legendArr&&$.each(e.legendArr,function(t,n){e.legendArr[t].color=e.eventListener.fillStyle[t]}),e.eventListener.change&&t==n&&e.eventListener.change(e.legendArr))}}}),e.opts.definedContainer||(e.opts.definedContainer=e.container.parent()),e.opts.definedContainer.append('<div class="operat-panel map_tool sef-define help-colordefine" style="display: none;z-index:300;">\n                        <div class="operat-hit clearfix"><span class="thinblue font13">自定义方案</span><a href="javascript:;" class="btn-back ml05" title="返回"></a></div>\n                        <div class="operat-body oper_h nice-scroll" style="overflow: hidden; position: relative;" tabindex="5008">\n                        </div>\n                    </div>'),e.container.find(".help-btnDefineColor").unbind("click").click(function(){e.opts.definedContainer.find(".help-colordefine").show(),e.colorDefine()}),e.opts.definedContainer.find(".help-colordefine .btn-back").unbind("click").click(function(){e.opts.definedContainer.find(".help-colordefine").hide()}),n++}if(e.opts.dimensions.strokeStyle.show){e.container.append('<div class="form-row clearfix mt10">                    <div class="pull-left form-label">轮廓色值：</div>                    <div class="form-input pull-left help-section-strokecolor">\t\t\t\t\t    <div class="colorPicker"></div>\t\t\t\t\t    <div class="col_suspend posleft" style="display: none">\t\t\t\t\t\t    <div class="nice-scroll" style="max-height: 100px;">\t\t\t\t\t\t\t    <div class="color-list single_color p10">\t\t\t\t\t\t\t\t    <ul class="clearfix">\t\t\t\t\t\t\t\t    </ul>\t\t\t\t\t\t\t    </div>\t\t\t\t\t\t    </div>\t                            <div class="more_color_choose p10">                                <div class="color_box">                                    <input data-color="" data-control="hue" class="form-control finp input-sm fgw07 minicolors-input" type="hidden">                                </div>                            </div>\t\t\t\t\t    </div>\t\t\t\t\t\t</div>                    <div class="pull-left form-label ml10" style="width:60px;">透明度：</div>                    <div class="form-input pull-left mr05 help-strokestyle-opacity" style="width:60px;z-index:116;">                    </div>                </div>');var i=e.container.find(".help-section-strokecolor .colorPicker"),l="";$.each(e.opts.dimensions.strokeStyle.colors,function(e,t){l+='<li style="background:'+t+' none repeat scroll 0 0"></li>'}),e.eventListener.strokeStyle=e.opts.dimensions.strokeStyle.color,i.css("background",e.eventListener.strokeStyle+" none repeat scroll 0 0"),e.container.find(".help-section-strokecolor ul").html(l).find("li").unbind("click").click(function(){var i=$(this).index();e.container.find(".help-section-strokecolor ul").removeClass("on"),$(this).addClass("on"),e.container.find(".help-section-strokecolor .colorPicker").next().hide();var a=e.opts.dimensions.strokeStyle.colors[i];e.container.find(".help-section-strokecolor .colorPicker").css("background",a+" none repeat scroll 0 0"),e.eventListener.strokeStyle!=a&&(e.eventListener.strokeStyle=a.substring(0,a.lastIndexOf(",")+1)+e.eventListener.strokeStyleOpacity+")",e.eventListener.change&&t==n&&e.eventListener.change(e.legendArr))}),i.unbind("click").click(function(){"none"==$(this).next().css("display")?$(this).next().show():$(this).next().hide()}),e.container.find(".minicolors-input").minicolors({position:"top left",defaultValue:"rgb(152,240,254)",format:"rgb",theme:"demo",changeDelay:0,control:"hue",change:function(i,a){e.container.find(".help-section-strokecolor .colorPicker").css("background",i+" none repeat scroll 0 0");var o=i.replace("rgb","rgba");e.eventListener.strokeStyle!=o&&(e.eventListener.strokeStyle=o.substring(0,o.lastIndexOf(",")+1)+e.eventListener.strokeStyleOpacity+")",e.eventListener.change&&t==n&&e.eventListener.change(e.legendArr))}}),e.strokeStyleOpacitySel=new s($(".help-strokestyle-opacity"),{event:"click",data:function(){for(var e=[],t=0;t<=1;t+=.1)e.push({value:t.toFixed(1),text:t.toFixed(1)});return e}(),seleted:e.opts.dimensions.strokeStyle.opacity,eventListener:{change:function(i,a){e.eventListener.strokeStyleOpacity!=i.value&&(e.eventListener.strokeStyleOpacity=i.value,e.eventListener.strokeStyle=e.eventListener.strokeStyle.substring(0,e.eventListener.strokeStyle.lastIndexOf(",")+1)+e.eventListener.strokeStyleOpacity+")",e.eventListener.change&&t==n&&e.eventListener.change(e.legendArr))}}}),n++}},y.prototype.colorDefine=function(){var e=this,t="";$.each(e.opts.dimensions.strokeStyle.colors,function(e,n){t+='<li style="background:'+n+' none repeat scroll 0 0"></li>'});var n="";$.each(e.eventListener.fillStyle,function(e,i){n+='<div class="form-row clearfix mt10">                            <div class="pull-left form-label">分段'+(e+1)+'：</div>                            <div class="form-input pull-left">                                <div class="colorPicker" data-color="'+i+'" style="background:'+i+' none repeat scroll 0 0">                                </div>                                <div class="col_suspend posleft" style="display: none;">                                    <div class="nice-scroll" style="max-height: 100px; overflow: hidden;">                                        <div class="color-list p10 single_color">                                            <ul class="clearfix">                                                '+t+'                                            </ul>                                        </div>                                    </div>                                    <div class="more_color_choose p10">                                        <div class="color_box">                                            <input data-color="" data-control="hue" class="form-control finp input-sm fgw07 minicolors-input" type="hidden">                                        </div>                                    </div>                                </div>                            </div>                        </div>'}),e.opts.definedContainer.find(".help-colordefine .operat-body").html(n),e.opts.definedContainer.find(".help-colordefine  .operat-body .nice-scroll").getNiceScroll().resize(),e.opts.definedContainer.find(".help-colordefine ul li").unbind("click").click(function(){var t=$(this).index(),n=e.opts.dimensions.strokeStyle.colors[t];$(this).parent().parent().parent().parent().prev().css("background",n+" none repeat scroll 0 0"),$(this).parent().parent().parent().parent().prev().attr("data-color",n),$(this).parent().parent().parent().parent().hide();var i=$.map(e.opts.definedContainer.find(".help-colordefine .colorPicker"),function(e){return $(e).attr("data-color")});e.eventListener.fillStyle=i,e.eventListener.change&&e.change("change")}),e.opts.definedContainer.find(".help-colordefine .colorPicker").unbind("click").click(function(){"none"==$(this).next().css("display")?($(this).next().show(),e.opts.definedContainer.find(".help-colordefine .nice-scroll").getNiceScroll().resize()):$(this).next().hide()}),$.each(e.opts.definedContainer.find(".help-colordefine .colorPicker"),function(e,t){$.documentClick($(t),$(t).next())}),e.opts.definedContainer.find('.help-colordefine input[type="hidden"]').minicolors({position:"top left",defaultValue:"rgb(152,240,254)",format:"rgb",theme:"demo",changeDelay:0,control:"hue",change:function(t,n){var i=t.replace("rgb","rgba");$(this).parent().parent().parent().parent().prev().css("background",i.substring(0,i.length-1)+",1) none repeat scroll 0 0"),$(this).parent().parent().parent().parent().prev().attr("data-color",i.substring(0,i.length-1)+",1)");var a=$.map(e.opts.definedContainer.find(".help-colordefine .colorPicker"),function(e){return $(e).attr("data-color")});e.eventListener.fillStyle=a,e.eventListener.change&&e.change("change")}})},y.prototype.sectionTypeVal=function(e){var t=this;return{type:t.eventListener.sectionType,quantity:t.eventListener.sectionQuantity}},y.prototype.fillStyleVal=function(e){var t=this;return{colors:t.eventListener.fillStyle,opacity:t.eventListener.fillStyleOpacity}},y.prototype.strokeStyleVal=function(e){var t=this;return{color:t.eventListener.strokeStyle,opacity:t.eventListener.strokeStyleOpacity}},y.prototype.display=function(e,t){},y.prototype.setData=function(e){var t=this;e&&(t.opts.data=e),t.legendArr=g({data:t.opts.data,isOrder:t.opts.isOrder,sectionType:t.eventListener.sectionType,sectionQuantity:t.eventListener.sectionQuantity,colors:t.eventListener.fillStyle})},y.prototype.change=function(e){e=e||"change";var t=this,n=t.getLegendData();t.eventListener[e]&&t.eventListener[e](n)},y.prototype.getLegendData=function(){var e=this;if(!e.opts.data||e.opts.data.length<=0)return null;var t={data:e.opts.data,isOrder:e.opts.isOrder,sectionType:e.eventListener.sectionType,sectionQuantity:e.eventListener.sectionQuantity,colors:e.eventListener.fillStyle};return e.legendArr=g(t),e.legendArr};var P={isometry:function(e){e=$.extend(!0,{},e);var t=this;e.max=e.max||e.data[e.data.length-1],e.min=e.min||e.data[0];for(var n=e.max-e.min,i="number"==typeof e.toFixed&&0==e.toFixed&&e.sectionQuantity>n?n:e.sectionQuantity,a=n/i,o=[],l=e.min>1e4?e.min>1e8?1e8:1e4:1,s=e.min>1e4?e.min>1e8?"亿":"万":"",c=[],r=0;r<i;r++){var d=(e.min+a*r)/l,f=(e.min+a*(r+1))/l;c.push(d),c.push(f)}c=c.unique();for(var p=t.rounding(c),r=0;r<p.length-1;r++)o.push({begin:t.DataConvert(s,p[r]),end:t.DataConvert(s,p[r+1]),range:p[r]+s+"-"+p[r+1]+s});return o},fenwei:function(e){var t=this,n=e.sectionQuantity,i=e.data,a=new Array,o=i.length,l=[],s="";if(0==o)return[];if(o<=n){var c=i;return t.lessThanCount(c,o)}var r=parseFloat((1/n).toString().substring(0,4)),d=o,f=i,p=parseFloat((1*r).toString().substring(0,4)),u=parseFloat((r*(n-1)).toString().substring(0,4)),h=parseInt((p*d+u).toString().split(".")[0]),v=(p*d+u-h).toString().substring(0,4),m=0,y=0;m=parseFloat(f[h-1]),y=parseFloat(f[h]);for(var b=parseFloat(m+v*(y-m)),g=1;g<n&&g<d;g++){p=parseFloat((r*g).toString().substring(0,4)),u=parseFloat((r*(n-g)).toString().substring(0,4)),h=parseInt((p*d+u).toString().split(".")[0]),v=parseFloat(p*d+u-h).toFixed(4),m=parseFloat(f[h-1]),y=parseFloat(f[h]);var k=parseFloat(m+v*(y-m));l[g-1]=b>1e4?b>1e8?k/1e8:k/1e4:k,s=b>1e4?b>1e8?"亿":"万":""}for(var x=t.rounding(l,b),C=0;C<x.length;C++)if(0==C){var $=new Object;$.range=x[C]+s+"以下",$.begin=-999999,$.end=t.DataConvert(s,x[C]),a.push($)}else if(C==x.length-1){var $=new Object;$.range=x[C-1]+s+"-"+x[C]+s,$.begin=t.DataConvert(s,x[C-1]),$.end=t.DataConvert(s,x[C]),a.push($);var S=new Object,_=x[C]+s+"以上";S.range=_,S.begin=t.DataConvert(s,x[C]),S.end=9999999999,a.push(S)}else{var $=new Object;$.range=x[C-1]+s+"-"+x[C]+s,$.begin=t.DataConvert(s,x[C-1]),$.end=t.DataConvert(s,x[C]),a.push($)}return a},natural:function(e){var t=this,n=e.data.unique(),i=e.sectionQuantity;if(n.length<=i)return t.lessThanCount(n,n.length);var a=t.jenksMatrices(n,i),o=a.lower_class_limits,l=n.length-1,s=[],c=i;for(s[i]=n[n.length-1],s[0]=n[0];c>1;)s[c-1]=n[o[l][c]-2],l=o[l][c]-1,c--;for(var r=t.rounding(s),d=[],f=0;f<r.length-1;f++)d.push({range:r[f]+"-"+r[f+1],begin:r[f],end:r[f+1]});return d},DataConvert:function(e,t){return""==e?t:"万"==e?1e4*t:"亿"==e?1e8*t:t},lessThanCount:function(e,t){var n=new Array;if(1==t){var i=parseFloat(e[0]).toString();return parseFloat(i)!=i&&(i=0),[{range:i,begin:i,end:i}]}for(var a=0;a<t;a++){var i=e[a];parseFloat(i)!=i&&(i=0),n.push({range:i,begin:i,end:i})}return n},rounding:function(e,t){for(var n=[],i=0;i<e.length-1;i++){var a=parseInt(Math.floor(Math.log10(e[i+1]-e[i])))+1,o=1;0!=e[i]&&(o=parseInt(Math.floor(Math.log10(Math.abs(e[i]))))+1);var l=0;l=a>=o?o-1:o-2,l=1==l&&1==o?0:l;var s=l<0?Math.abs(l):0;if(n[i]=(Math.round(e[i]/Math.pow(10,l),0)*Math.pow(10,l)).toFixed(s),i==e.length-2){var c=parseInt(Math.floor(Math.log10(e[i+1])))+1;n[i+1]=c==o?(Math.round(e[i+1]/Math.pow(10,l),0)*Math.pow(10,l)).toFixed(s):(Math.round(e[i+1]/Math.pow(10,l+1),0)*Math.pow(10,l+1)).toFixed(s)}}return n},jenksMatrices:function(e,t){var n,i,a=[],o=[],l=0;for(n=0;n<e.length+1;n++){var s=[],c=[];for(i=0;i<t+1;i++)s.push(0),c.push(0);a.push(s),o.push(c)}for(n=1;n<t+1;n++)for(a[1][n]=1,o[1][n]=0,i=2;i<e.length+1;i++)o[i][n]=1/0;for(var r=2;r<e.length+1;r++){for(var d=0,f=0,p=0,u=0,h=1;h<r+1;h++){var v=r-h+1,m=e[v-1];if(p++,d+=m,f+=m*m,l=f-d*d/p,0!==(u=v-1))for(var i=2;i<t+1;i++)o[r][i]>=l+o[u][i-1]&&(a[r][i]=v,o[r][i]=l+o[u][i-1])}a[r][1]=1,o[r][1]=l}return{lower_class_limits:a,variance_combinations:o}},getColors:function(e){e=$.extend({},{max:10,min:0,sectionQuantity:10},e);for(var t={},n=1/e.colors.length,i=0;i<e.colors.length;i++)t[i*n]=e.colors[e.colors.length-1-i];for(var a=e.max-e.min,o=new b({max:a,gradient:t}),l="number"==typeof e.toFixed&&0==e.toFixed&&e.sectionQuantity>a?a:e.sectionQuantity,s=a/l,c=[],i=0;i<l;i++){var r=s*i;"number"==typeof e.toFixed&&(r=r.toFixed(e.toFixed)),c.push(o.getColor(parseFloat(r)))}return c}};b.prototype.initPalette=function(){var e=this.gradient;if("undefined"==typeof document);else var t=document.createElement("canvas");t.width=256,t.height=1;var n=this.paletteCtx=t.getContext("2d"),i=n.createLinearGradient(0,0,256,1);for(var a in e)i.addColorStop(parseFloat(a),e[a]);n.fillStyle=i,n.fillRect(0,0,256,1)},b.prototype.getColor=function(e){var t=this.max;e>t&&(e=t);var n=4*Math.floor(e/t*255),i=this.paletteCtx.getImageData(0,0,256,1).data;return"rgba("+i[n]+", "+i[n+1]+", "+i[n+2]+", "+i[n+3]/256+")"},b.prototype.getSize=function(e){var t=this.max,n=this.maxSize,i=this.minSize;return e>t&&(e=t),i+e/t*(n-i)},k.prototype={_getConfig:function(){var e=this,t=e.opts,n=t.tabs||[],i=$.extend(!0,[],e.configType[t.type]),a=[];return e.isGrid?$.each(i,function(e,t){"polygon-grid"==t.type&&a.push(t)}):n.length>0?$.each(i,function(e,t){n.indexOf(t.type)>-1&&a.push(t)}):$.each(i,function(e,t){"polygon-grid"!=t.type&&a.push(t)}),a},_renderContainerDom:function(e,t){var n=this,i=($(n.container),$(n.box)),a=(t.section,t.type),o="";n.flag=!1,n.callbackData={vizConfig:{},colorLegend:null},o+='<div class="panel sf_panel" id="'+n.opts.id+'">\n                        <div class="panel-head clearfix">\n                            <h3 class ="fl panel-head-title"><span>'+t.title+'</span></h3>\n                            <a href="javascript:;" class="fr but-collap"></a>\n                            <a href="javascript:;" class="fr blue01 mr10 control-panel">隐藏图层</a>\n                        </div>\n                        <div class="panel-body" style="'+(n.opts.data?"block":"none")+'">\n                            <div class="map_tool">',o+='<div class="form-row clearfix mt10" name="type_switch">\n                <div class ="navtabbox01 '+("point"==a?"col-05":"polygon"==a||"line"==a?"col-03":"")+'">';var l=n._getConfig();$.each(l,function(e,t){var i="marker-choropleth"==t.type||"marker-bubble"==t.type||"marker-heat"==t.type||"polygon-choropleth"==t.type||"od"==t.type||"polygon-grid"==t.type,a=i&&n.numberTypes&&0==n.numberTypes.length&&"polygon-grid"!=t.type?"forbid":"";o+='<a href="javascript:;" class ="'+(0==e?"on":"")+" "+a+'" type="'+t.type+'" style="display:'+(t.icon&&!t.hide?"block":"none")+'" name="'+(t.hide?"hide":"")+'">\n                        <span class ="iconbox '+t.icon+'"></span>\n                        <span class ="txt mt05">'+t.text+"</span>\n                    </a>"}),o+="</div>\n            </div>",t.line&&("line"==a&&(o+='<div class="form-row clearfix mt10" type="" data-box="line">\n                            <div class ="pull-left form-label">线样式</div>\n                            <div class ="form-input pull-left colo-border">\n                                <div class ="colorPicker" name="lineColor" style="background:'+t.line.lineColor+'" value="'+t.line.lineColor+'">\n                                </div>\n                            </div>\n                            <div class ="form-input pull-left fwid03 ml10" name="lineWidth"></div>\n                            <div class ="pull-left form-label">透明度</div>\n                            <div class ="form-input pull-left fwid03" name="lineOpacity"></div>\n                        </div>'),"od"==a&&(o+='<div class="form-row clearfix mt10" type="" data-box="line">\n                            <div class ="pull-left form-label">线宽</div>\n                            <div class ="form-input pull-left fwid03" name="lineWidth"></div>\n                            <div class ="pull-left form-label">透明度</div>\n                            <div class ="form-input pull-left fwid03" name="lineOpacity"></div>\n                        </div>')),t.section&&t.section.fieldNameSet&&(o+='<div class="form-row clearfix mt10" type="section-index" data-box="sectionIndex">\n                        <div class ="pull-left form-label">分段指标</div>\n                        <div class ="form-input pull-left fwid01" name="fieldName" value="'+t.section.fieldName+'"></div>\n                        </div>'),t.section&&t.section.classifyIndexSet&&(o+='<div class="form-row clearfix mt10" type="section-index" data-box="classifyIndex" style="display:none;">\n                        <div class ="pull-left form-label">分类指标</div>\n                        <div class ="form-input pull-left fwid01" name="fieldName" value=""></div>\n                    </div>'),t.section&&t.section.bucketCountSet&&(o+='<div class="form-row clearfix mt10" data-box="sectionClassify">\n                            <div class ="pull-left form-label">分段方法</div>\n                            <div class ="form-input pull-left fwid02" name="bucketType" value="'+t.section.bucketType+'"></div>\n                            <div class="pull-left form-label" style="display:'+(t.defaultBucket?"none":"block")+'">分段数</div>\n                            <div class ="form-input pull-left fwid03" name="bucketCount" style="display:'+(t.defaultBucket?"none":"block")+'" value="'+t.section.bucketCount+'"></div>\n                        </div>'),t.section&&t.section.classifyIndexSet&&(o+='<div class="form-row clearfix mt10" data-box="fillList" style="display:none;">\n                                    <div class="pull-left form-label">&nbsp;</div>\n                                    <div class="form-input pull-left">\n                                        <div class="subcolor-list nice-scroll">\n                                            <ul>\n                       \n                                            </ul>\n                                        </div>\n                                    </div>\n                                </div>'),t.heat&&(o+='<div class="form-row clearfix mt10" data-box="heat">\n\n                            </div>',o+='<div class="form-row clearfix mt10" data-box="heat">\n\n                            </div>'),t.radius&&(o+='<div class="form-row clearfix mt10" data-box="radius">\n                                <div class="pull-left form-label">半径指标</div>\n                               <div class ="form-input pull-left fwid01" name="fieldName" value="param.radius.fildName"></div>\n                   </div><div class="form-row clearfix mt10" data-box="radius">\n                                <div class ="pull-left form-label">分段方法</div>\n                               <div class ="form-input pull-left fwid02" name="bucketType" value="param.radius.bucketType"></div>\n                               <div class ="pull-left form-label">段数</div>\n                               <div class ="form-input pull-left fwid03" name="bucketCount" value="param.radius.bucketCount"></div>\n                   </div><div class="form-row clearfix mt10" data-box="radius">\n                                <div class="pull-left form-label">半径范围</div>\n                               <div class ="form-input pull-left fwid03" name="minSize" value="param.radius.minSize"></div>\n\n                               <div class ="form-input pull-left fwid03 ml10" name="maxSize" value="param.radius.maxSize"></div>\n                   </div>'),t.fill&&(o+='<div class="form-row clearfix mt10" data-box="fillColor" style="display:none;">\n                                <div class="pull-left form-label">填充颜色</div>\n                                <div class="form-input pull-left colo-border">\n                                    <div class ="colorPicker" name="fillColor" style="background:'+t.fill.fillColor+'" value="'+t.fill.fillColor+'">\n\n                                    </div>\n                                </div>\n                                <div class="pull-left form-label">透明度</div>\n                                <div class ="form-input pull-left fwid03" name="fillOpacity" value="'+t.fill.fillOpacity+'"></div>\n                      </div>'),t.marker&&(o+='<div class="form-row clearfix mt10" data-box="marker" style="display:none;">\n                                <div class="pull-left form-label">填充颜色</div>\n                                <div class="form-input pull-left colo-border">\n                                    <div class ="colorPicker" name="markerColor" style="background:'+t.marker.markerColor+'" value="'+t.marker.markerColor+'">\n\n                                    </div>\n                                </div>\n                                <div class ="pull-left form-label form-label-widsm">尺寸</div>\n                                <div class ="form-input pull-left fwid03" name="markerSize" value="'+t.marker.markerSize+'"></div>\n                                <div class="pull-left form-label">透明度</div>\n                                <div class ="form-input pull-left fwid03" name="markerOpacity" value="'+t.marker.markerOpacity+'"></div>\n                      </div>'),t.fillMode&&(o+='<div class="form-row clearfix mt10" data-box="fillMode">\n\n                   </div>'),t.section&&t.section.fillColorSet&&(o+='<div class="form-row clearfix mt10" data-box="fillSection">\n                                    <div class ="pull-left form-label">填充颜色</div>\n                                    <div class="form-input pull-left fwid02">\n                                        <div class="form_select clearfix">\n                                            <div class ="colorPicker" value="'+t.section.fillColor+'" style="background:'+n._linear(t.section.fillColorSet[t.section.fillColor])+'"></div>\n                                            <em class="fr icon_caret01"></em>\n                                        </div>\n                                        <div class="col_suspend posleft" style="display:none;">\n                                            <div class="nice-scroll">\n                                                <div class="color-list p10">\n                                                    <ul class="clearfix" data-select="colorlist">',$.each(t.section.fillColorSet?t.section.fillColorSet:M,function(e,t){o+="<li key="+e+' style="background:linear-gradient(to right,',$.each(t,function(e,n){o+=n+(e==t.length-1?"":",")}),o+='"></li>'}),o+='</ul>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="pull-left form-label">透明度</div>\n                            <div class ="form-input pull-left fwid03" name="'+("line"==a?"lineOpacity":"line"==a?"lineOpacity":"polygon"==a?"fillOpacity":"")+'">\n\n                            </div>\n                        </div>'),t.colorBucket&&(o+='<div class="form-row clearfix mt10" data-box="colorBucket">\n                                <div class="pull-left form-label">颜色指标</div>\n                               <div class ="form-input pull-left fwid01" name="colorFieldName" value="param.colorBucket.colorFieldName"></div>\n                   </div><div class="form-row clearfix mt10" data-box="colorBucket">\n                                <div class ="pull-left form-label">分段方法</div>\n                               <div class ="form-input pull-left fwid02" name="colorBucketType" value="param.colorBucket.colorBucketType"></div>\n                               <div class ="pull-left form-label">段数</div>\n                               <div class ="form-input pull-left fwid03" name="colorBucketCount" value="param.colorBucket.colorBucketCount"></div>\n                   </div>'),t.outline&&(o+='<div class="form-row clearfix mt10" data-box="outline">\n                                <div class="pull-left form-label">边界色</div>\n                                <div class="form-input pull-left colo-border">\n                                    <div class ="colorPicker" name="outlineColor" style="background:'+t.outline.outlineColor+'" value="'+t.outline.outlineColor+'">\n                                    </div>\n                                </div>\n\n                               <div class="pull-left form-label form-label-widsm">宽度</div>\n                               <div class ="form-input pull-left fwid03" style="" name="outlineWidth" value="param.outline.outlineWidth"></div>\n\n                               <div class="pull-left form-label">透明度</div>\n                               <div class ="form-input pull-left fwid03" name="outlineOpacity" value="param.outline.outlineOpacity"></div>\n                   </div>'),t.blendingMode&&t.blendingMode.show&&(o+='<div class="form-row clearfix mt10" data-box="blendingMode">\n\n                            </div>'),t.time&&(o+='<div class="form-row clearfix mt10" data-box="time">\n                            <div class="pull-left form-label">播放间隔</div>\n                            <div class ="form-input pull-left fwid03" name="topValue" value="'+t.time.time+'"></div>\n                    </div>'),t.hrLine&&t.hrLine.show&&(o+='<div class="hr-line"></div>'),t.label&&t.label.show&&(o+='<div  class="form-row clearfix mt10" data-box="label" style="display:'+(t.index.data&&t.index.data.length>0?"block":"none")+'">\n                            <div class="pull-left form-label">标注</div>\n                        <div class="form-input pull-left colo-border">\n                                <div class ="colorPicker" name="labelColor" style="background:'+t.label.labelColor+'" value="'+t.label.labelColor+'"></div>\n                        </div>',o+='<div class ="form-input pull-left fwid04 ml10" name="labelField" value="'+t.label.labelField+'">\n                        </div>',o+="</div>",o+=' <div  class="form-row clearfix mt10" data-box="label">\n                                <div class="pull-left form-label">字体</div>\n                                <div class ="form-input pull-left fwid02" name="labelFont" value="'+t.label.labelFont+'"></div>\n                                <div class="pull-left form-label">字号</div>\n                                <div class ="form-input pull-left fwid03"  name="labelSize" value="'+t.label.labelSize+'"></div>\n                            </div>'),t.od&&(o+='<div  class="form-row clearfix mt10" data-box="od">\n                            <div class="pull-left form-label">弯曲度</div>\n                            <div class ="form-input pull-left fwid03" name="curvature" value="'+t.od.curvature+'"></div>\n                            <div class ="pull-left form-label">标记类型</div>\n                            <div class ="form-input pull-left fwid02 ml10" name="symbol" value="'+t.od.symbol+'"></div>\n                    </div>'),o+="</div></div></div>",i.append(o),n.container=$("#"+n.opts.id),e=n.container,t.line&&n._initLine(e,t),t.section&&t.section.fieldNameSet&&n._initSectionIndex(e,t),t.section&&t.section.classifyIndexSet&&n._initClassifyIndex(e,t),t.section&&t.section.bucketType&&n._initSectionClassify(e,t),t.section&&t.section.fillOpacitySet&&n._initFillSection(e,t),t.fill&&n._initFillColor(e,t),t.marker&&n._initMarker(),t.outline&&n._initOutline(e,t),t.blendingMode&&n._initBlendingMode(e,t),t.label&&n._initLabel(e,t),t.colorBucket&&n._initColorBucket(e,t),t.radius&&n._initRadius(e,t),t.fillMode&&n._initFillMode(e,t),t.heat&&n._initHeat(e,t),t.time&&n._initTime(e,t),t.od&&n._initOD(e,t),n._bindCommonEvent(e,t),n.flag=!0},_initConfigTypes:function(){var e=this,t=$(e.container),n=(e.opts,t.find(".navtabbox01 a[name!=hide]"));$.each(n,function(t,n){var i=$(n).attr("type");"marker-choropleth"!=i&&"marker-bubble"!=i&&"marker-heat"!=i&&"polygon-choropleth"!=i&&"od"!=i||0!=e.numberTypes.length?$(n).removeClass("forbid"):$(n).addClass("forbid")})},_initSectionIndex:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.section),o=i.find("[data-box=sectionIndex]").find(".form-input");n.numberTypes&&n._select(o,a.fieldNameSet,a.fieldName)},_initClassifyIndex:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.section),o=i.find("[data-box=classifyIndex]").find(".form-input");n._select(o,a.classifyIndexSet,a.classifyIndex)},_initSectionClassify:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.section),o=i.find("[data-box=sectionClassify]").find(".form-input");n.opts.defaultBucket&&(a.bucketTypeSet.unshift({value:"default",text:"默认分段"}),a.bucketType="default"),n._select(o.eq(0),a.bucketTypeSet,a.bucketType),n._select(o.eq(1),a.bucketCountSet,a.bucketCount)},_initOutline:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.outline),o=i.find("[data-box=outline]").find(".form-input");n._select(o.eq(1),a.outlineWidthSet,a.outlineWidth),n._select(o.eq(2),a.outlineOpacitySet,a.outlineOpacity)},_initLine:function(e,t){var n=this,i=$(n.container),a=$.extend(!0,{},n.opts.line),o=i.find("[data-box=line]").find(".form-input");"line"==n.opts.type&&(n._select(o.eq(1),a.lineWidthSet,a.lineWidth),n._select(o.eq(2),a.lineOpacitySet,a.lineOpacity)),"od"==n.opts.type&&(n._select(o.eq(0),a.lineWidthSet,a.lineWidth),n._select(o.eq(1),a.lineOpacitySet,a.lineOpacity))},_initHeat:function(e,t){var n=this,i=$(n.container),a=$.extend(!0,{},n.opts.heat),o=a.heatSize,l=i.find("[data-box=heat]"),s="",c="";s+='<div class="pull-left form-label">热度权重</div>\n                            <div class ="form-input pull-left fwid01" name="weightField" value="data.weightField"></div>',l.eq(0).append(s),n._select(l.eq(0).find(".form-input"),a.weightFieldSet,a.weightField),c+='<div class="pull-left form-label">热点半径</div>\n                                <div class ="navtabbox pull-left" name="heatSizeUnit" value="'+a.heatSizeUnit+'">',$.each(a.heatSizeUnitSet,function(e,t){c+='<a href="javascript:;" class="'+(t.value==a.heatSizeUnit?"on":"")+'" value="'+t.value+'">\n                                        <span >'+t.text+"</span></a>"}),c+="</div>",$.each(a.heatSizeUnitSet,function(e,t){c+='<div class="form-input pull-left fwid03" name="heatSize" type="'+t.value+'" value="'+t.configSet[o]+'" style="width:60px;display:'+(t.value==a.heatSizeUnit?"block":"none")+'"></div><span class="fwid03 pull-left ml10" style="line-height:22px;display:'+(t.value==a.heatSizeUnit?"block":"none")+'" type="'+t.value+'">'+t.unit+"</span>"}),l.eq(1).append(c),$.each(a.heatSizeUnitSet,function(e,t){n._select(l.eq(1).find(".form-input").eq(e),t.configSet,t.configSet[o])})},_initFillSection:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.section),o=n.opts.type,l=i.find("[data-box=fillSection]").find(".form-input");if("od"==o)return void l.eq(1).hide().prev().hide();n._select(l.eq(1),a.fillOpacitySet,a.fillOpacity),"point"==o&&l.eq(1).attr("name","markerOpacity"),"line"!=o&&"od"!=o||l.eq(1).attr("name","lineOpacity")},_initFillColor:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.fill),o=i.find("[data-box=fillColor]").find(".form-input");n._select(o.eq(1),a.fillOpacitySet,a.fillOpacity)},_initMarker:function(){var e=this,t=$(e.container),n=$.extend(!0,{},e.opts.marker),i=t.find("[data-box=marker]").find(".form-input");e._select(i.eq(1),n.markerSizeSet,n.markerSize),e._select(i.eq(2),n.markerOpacitySet,n.markerOpacity)},_initBlendingMode:function(e,t){var n=$(e),i="",a=$.extend(!0,{},t.blendingMode);i+='<div class="pull-left form-label">模式</div>\n                                <div class ="navtabbox pull-left" name="blendingMode" value="'+a.type+'">',$.each(a.typeSet,function(e,t){i+='<a href="javascript:;" class="'+(0==e?"on":"")+'" value="'+t.value+'">\n                                        <span >'+t.text+"</span>\n                                    </a>"}),i+="</div>",n.find("[data-box=blendingMode]").empty().html(i)},_initLabel:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.label),o=i.find("[data-box=label]").find(".form-input");n._select(o.eq(1),a.labelFieldSet,a.labelField),n._select(o.eq(2),a.labelFontSet,a.labelFont),n._select(o.eq(3),a.labelSizeSet,a.labelSize)},_initRadius:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.radius),o=i.find("[data-box=radius]");n._select(o.eq(0).find(".form-input").eq(0),a.fieldNameSet,a.fieldName),n._select(o.eq(1).find(".form-input").eq(0),a.bucketTypeSet,a.bucketType),n._select(o.eq(1).find(".form-input").eq(1),a.bucketCountSet,a.bucketCount),n._select(o.eq(2).find(".form-input").eq(0),a.minSizeSet,a.minSize),n._select(o.eq(2).find(".form-input").eq(1),a.maxSizeSet,a.maxSize)},_initColorBucket:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.colorBucket),o=i.find("[data-box=colorBucket]");n._select(o.eq(0).find(".form-input").eq(0),a.colorFieldNameSet,a.colorFieldName),n._select(o.eq(1).find(".form-input").eq(0),a.colorBucketTypeSet,a.colorBucketType),n._select(o.eq(1).find(".form-input").eq(1),a.colorBucketCountSet,a.colorBucketCount)},_initFillMode:function(e,t){var n=$(e),i="",a=$.extend(!0,{},t.fillMode);i+='<div class="pull-left form-label">填充类型</div>\n                                <div class ="navtabbox pull-left" name="fillMode" value="'+a.type+'">',$.each(a.typeSet,function(e,t){i+='<a href="javascript:;" class="'+(0==e?"on":"")+'" value="'+t.value+'">\n                                        <span >'+t.text+"</span>\n                                    </a>"}),i+="</div>",n.find("[data-box=fillMode]").empty().html(i)},_initTime:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.time),o=i.find("[data-box=time]").find(".form-input");n._select(o.eq(0),a.topValueSet,a.topValue)},_initOD:function(e,t){var n=this,i=$(e),a=$.extend(!0,{},t.od),o=i.find("[data-box=od]").find(".form-input");n._select(o.eq(0),a.curvatureSet,a.curvature),n._select(o.eq(1),a.symbolSet,a.symbol)},_getSectionFillColorData:function(){var e=this,t=$(e.container),n=$.extend(!0,[],e.opts.data),i=t.find("[data-box=sectionIndex]").find(".form-input").attr("value"),a=t.find("[data-box=sectionClassify]").find(".form-input").eq(0).attr("value"),o=t.find("[data-box=sectionClassify]").find(".form-input").eq(1).attr("value"),l=t.find("[data-box=fillSection] .sel_text").eq(0).text(),s=t.find("[data-box=fillSection] .colorPicker").eq(0).attr("value"),c=e.opts.section.fillColorSet[s];if("default"==a){var r=4;o=5}else{var d=$.map(e.bucketTypes,function(e){if(e.value==a)return e}),r=d[0].funKey;o=n.length<o?n.length:o}var f=$.map(n,function(e){var t=parseFloat(e[i]);if(0==t||t)return t});if(0==f.length)return e.callbackData.vizConfig.buckets=[],void(e.callbackData.colorLegend=[]);f=f.unique(),f.sort(function(e,t){return e-t});var p=f[0],u=f[f.length-1],h=new g({data:f,isOrder:!1,sectionType:parseInt(r),sectionQuantity:parseInt(o),max:u,min:p,toFixed:2,colors:c,opacity:l});if("default"==a&&e.opts.defaultBucket){var v=e.opts.defaultBucket;h.forEach(function(e,t){e.range=v[t];var n=v[t].split("-");e.begin=parseFloat(n[0]),e.end=parseFloat(n[1])});var m=h}else{var y=[];$.each(h,function(e,t){t.range=t.range+"",h[e+1]&&t.range!=h[e+1].range&&y.push(t),h[e+1]||y.push(t)});var m=$.map(y,function(t){if(t.color=e._switchColor(t.color),!t.end&&t.range.indexOf("-")>-1){var n=t.range.split("-");t.end=parseFloat(n[1])}else t.range=t.range+"";return t});if(m.length>0){var b=m[0].range+"",k=b.split("-");b.indexOf("-")>-1&&k[0]==k[1]&&(m[0].range=p+"-"+k[0],m[0].begin=p)}m.reverse();var x=m.length,C=m[0].end?m[0].end:m[0].begin,S=m[x-1].begin?m[x-1].begin:m[x-1].end;C<u&&(m[0].end=u,m[0].range=m[0].begin+"-"+u),p<S&&(m[x-1].begin=p,m[x-1].range=p+"-"+m[x-1].end)}var _=[];$.each(m,function(t,n){"point"==e.opts.type?_.push({markerColor:e._switchColor(n.color),value:parseFloat(n.end)}):"polygon"==e.opts.type?_.push({fillColor:e._switchColor(n.color),value:parseFloat(n.end)}):"od"!=e.opts.type&&"line"!=e.opts.type||_.push({lineColor:e._switchColor(n.color),value:parseFloat(n.end)})});t.find(".navtabbox01 a.on").attr("type");e.callbackData.vizConfig.buckets=_,e.callbackData.colorLegend=m},getGridData:function(e){var t=this,n=$(t.container),i=($.extend(!0,[],t.opts.data),n.find("[data-box=sectionIndex]").find(".form-input").attr("value")),a=(n.find("[data-box=sectionClassify]").find(".form-input").eq(0).attr("value"),n.find("[data-box=sectionClassify]").find(".form-input").eq(1).attr("value")),o=(n.find("[data-box=fillSection] .sel_text").eq(0).text(),n.find("[data-box=fillSection] .colorPicker").eq(0).attr("value")),l=(t.opts.section.fillColorSet[o],{dataUid:t.dataUid,dataType:"private",field:i,method:"natural-breaks",classes:a-0});t.opts.listenLoading&&"function"==typeof t.opts.listenLoading&&t.opts.listenLoading("loading"),$.post(T.host+"/s/insight/v2/classification?ak="+T.ak,l,function(n){if(t.opts.listenLoading&&"function"==typeof t.opts.listenLoading&&t.opts.listenLoading("done"),n.data){var i=n.data;i.reverse(),t.gridSection=i,t.gridSectionColor(e)}})},gridSectionColor:function(e){var t=this,n=t.gridSection;if(n){var i=$(t.container),a=i.find("[data-box=fillSection] .colorPicker").eq(0).attr("value"),o=t.opts.section.fillColorSet[a],l=i.find("[data-box=fillSection] .sel_text").eq(0).text(),s={};$.each(o,function(e,t){var n=Math.floor(1/o.length*e*100)/100;s[n]=t});var c=new b({gradient:s,max:n.length}),r=[],d=[];$.each(n,function(e,i){var a=c.getColor(e);a=t._switchColor(a),d.push({value:i,fillColor:a,fillOpacity:l});var o=n[e+1];"[object Undefined]"!=Object.prototype.toString.call(o)?r.push({range:o+"-"+i,begin:o,end:i,color:a}):r.push({range:"<="+i,begin:-9999999999999,end:i,color:a})}),t.callbackData.vizConfig.buckets=d,t.callbackData.colorLegend=r,e&&e()}},_judgeIsNumber:function(e){var t=this,n=$.extend(!0,[],t.types);if(n.length>0){var i=$.map(n,function(t){if(t.value==e)return t.dataType});return i[0]?i[0]:"string"}},_getClassifyFillColorData:function(){var e=this,t=$(e.container),n=$.extend(!0,[],e.opts.data),i=t.find("[data-box=classifyIndex]").find(".form-input").eq(0).attr("value"),a=t.find("[data-box=fillSection] .colorPicker").eq(0).attr("value"),o=(t.find("[data-box=fillSection] .form-input").eq(1).attr("value"),t.find("[data-box=fillList]").find(".subcolor-list ul")),l="",s=e._judgeIsNumber(i),c=$.map(n,function(e){if(void 0!==e[i])return e[i]});c=c.unique(),"string"!=s&&c.sort(function(e,t){return t-e});var r=e.opts.section.fillColorSet[a],d={};$.each(r,function(e,t){var n=Math.floor(1/r.length*e*100)/100;d[n]=t});var f=new b({gradient:d,max:c.length}),p=[],u=[];$.each(c,function(t,n){var i=(isNaN(Number(n))&&n.length,f.getColor(t));i=e._switchColor(i);var a="int"==s?parseInt(n):"float"==s?parseFloat(n):"string"==s?n+"":n;if("point"==e.opts.type)if(t<100)p.push({value:a,markerColor:i});else{if(100!=t)return;p.push({value:"NAN",markerColor:"#ffffff"})}else if("line"==e.opts.type)if(t<100)p.push({value:a,lineColor:i});else{if(100!=t)return;p.push({value:"NAN",lineColor:"#ffffff"})}else if(t<100)p.push({value:a,fillColor:i});else{if(100!=t)return;p.push({value:"NAN",fillColor:"#ffffff"})}if(t<100)u.push({range:a,color:i,value:a});else{if(100!=t)return;u.push({range:"其他",color:"#ffffff",value:"其他"})}l+='<li class="clearfix" key="'+t+'"><span class="fl">'+n+'</span><div class="colorPicker fr" style="background:'+i+'" value="'+i+'"></div></li>'}),o.empty().html(l),o.parent().getNiceScroll().show(),o.parent().getNiceScroll().resize();t.find(".navtabbox01 a.on").attr("type");return e.callbackData.vizConfig.buckets=p,e.callbackData.colorLegend=u,t.find("[data-box=fillList] li .colorPicker").unbind("click").click(function(){var n=$(this);n.parents(".form-row").eq(0).data("box");e._renderColorSelect(t,e.opts,n)}),p},_getMarkRangeData:function(){var e=this,t=$(e.container),n=$.extend(!0,[],e.opts.data),i=t.find("[data-box=radius]"),a=i.eq(0).find(".form-input").attr("value"),o=i.eq(1).find(".form-input").eq(0).attr("value"),l=i.eq(1).find(".form-input").eq(1).attr("value"),s=i.eq(2).find(".form-input").eq(0).attr("value"),c=i.eq(2).find(".form-input").eq(1).attr("value"),r=$.map(e.bucketTypes,function(e){if(e.value==o)return e});o=r[0].funKey,l=n.length<l?n.length:l;var d=$.map(n,function(e){var t=parseFloat(e[a]);if(0==t||t)return t});if(d&&0==d.length)return void(e.callbackData.vizConfig.buckets=[]);d=d.unique(),d.sort(function(e,t){return e-t});var f=new g({data:d,isOrder:!1,sectionType:parseInt(o),sectionQuantity:parseInt(l),max:d[d.length-1],min:d[0]}),p=$.map(f,function(e){return{range:e.range+""}}),u=[];$.each(p,function(e,t){t.range.split("-").length>1&&e!=p.length-1?t.range==p[e+1]||u.push(t):u.push(t)}),$.each(p,function(e,t){var n=t.range.split("-");2==n.length?(t.start=n[0],t.end=n[1]):(0==e&&(t.start=-9999999999,t.end=parseFloat(n[0])),e==p.length-1&&(t.start=parseFloat(n[0]),t.end=99999999999))}),f.reverse();var h=[];$.each(f,function(e,t){void 0!==t.end?h.push({value:parseFloat(t.end)}):h.push({value:parseFloat(t.begin)})}),console.log(h);var v=new b({maxSize:parseFloat(c),minSize:parseFloat(s),max:parseFloat(h[0].value)-parseFloat(h[h.length-1].value)});$.each(h,function(e,t){t.markerSize=parseFloat(v.getSize(parseFloat(t.value)))}),e.callbackData.vizConfig.buckets=h},_getColorBucketData:function(){var e=this,t=$(e.container),n=$.extend(!0,[],e.opts.data),i=t.find("[data-box=colorBucket]").eq(0).find(".form-input").attr("value"),a=t.find("[data-box=colorBucket]").eq(1).find(".form-input").eq(0).attr("value"),o=t.find("[data-box=colorBucket]").eq(1).find(".form-input").eq(1).attr("value"),l=t.find("[data-box=fillSection] .sel_text").eq(0).text(),s=t.find("[data-box=fillSection] .colorPicker").eq(0).attr("value"),c=e.opts.section.fillColorSet[s],r=$.map(e.bucketTypes,function(e){if(e.value==a)return e});a=r[0].funKey,o=n.length<o?n.length:o;var d=$.map(n,function(e){var t=parseFloat(e[i]);if(0==t||t)return t});d=d.unique(),d.sort(function(e,t){return e-t});var f=new g({data:d,isOrder:!1,sectionType:parseInt(a),sectionQuantity:parseInt(o),max:d[d.length-1],min:d[0],colors:c,opacity:l});$.each(f,function(t,n){n.color=e._switchColor(n.color),n.range=n.range+""});var p=$.extend(!0,[],f);f.reverse();var u=[];$.each(f,function(t,n){void 0!==n.end?u.push({markerColor:e._switchColor(n.color),value:parseFloat(n.end)}):u.push({markerColor:e._switchColor(n.color),value:parseFloat(n.begin)})}),e.callbackData.vizConfig.colorBuckets=u,e.callbackData.colorLegend=p},_getHeatData:function(){var e=this,t=$(e.container),n={},i=t.find("[data-box=fillSection] .colorPicker").eq(0).attr("value"),a=e.opts.section.fillColorSet[i];$.each(a,function(t,i){t>=5||(0==t?n[1]=e._switchColor(i):n[(.2*t).toFixed(1)+""]=e._switchColor(i))}),e.callbackData.vizConfig.heatMinOpacity=0,e.callbackData.vizConfig.resolution=4,e.callbackData.vizConfig.colors=n},_bindCommonEvent:function(e,t){var n=this,i=$(e),a=(i.find("[data-box=sectionIndex]"),i.find("[data-box=sectionClassify]"),i.find("[data-box=classifyIndex]"),i.find("[data-box=fillColor]"),i.find("[data-box=fillSection]"));i.find("[data-box=outline]"),i.find("[data-box=blendingMode]"),i.find("[data-box=label]");a.find(".form_select").eq(0).unbind("click").click(function(){var e=$(this),t=e.next(),a=t.css("display");$(n.box).find("[data-box=fillSection] .form_select").next().hide(),"none"==a&&t.show(),$(n.box).find(".colorPicker").next(".col_suspend").hide(),i.find('[data-box="fillList"] .nice-scroll').getNiceScroll().hide(),$(n.box).parent(".nice-scroll").getNiceScroll().resize()}),a.find(".color-list li").unbind("click").click(function(){var e=$(this),t=e.attr("key"),a=e.parents(".col_suspend").eq(0),o=a.prev().find(".colorPicker"),l=e.css("background");i.find("[data-box=sectionIndex]").css("display"),i.find("[data-box=sectionClassify]").css("display");a.hide(),o.css("background",l).attr("value",t),n._getSectionData("fillSection")}),i.find("[data-box=blendingMode],[data-box=fillMode],[data-box=heat]").find(".navtabbox a").unbind("click").click(function(){var e=$(this),t=e.parents(".form-row").eq(0),a=e.attr("value"),o=(e.text(),e.parent());e.addClass("on").siblings().removeClass("on"),o.attr("value",a),"heat"==t.data("box")?(t.find(".form-input[type="+a+"]").show().next("span").show(),t.find(".form-input[type!="+a+"]").hide().next("span").hide()):"fillMode"==t.data("box")&&("single"==e.attr("value")?(i.find("[data-box=marker]").show(),i.find("[data-box=fillSection]").hide(),i.find("[data-box=colorBucket]").hide()):"multi"==e.attr("value")&&(i.find("[data-box=marker]").hide(),i.find("[data-box=fillSection]").show(),i.find("[data-box=colorBucket]").show())),n._getSectionData()}),i.find("[data-box=outline],[data-box=fillColor],[data-box=label],[data-box=line],[data-box=marker]").find(".colorPicker").unbind("click").click(function(){var i=$(this);i.parents(".form-row").eq(0).data("box");n._renderColorSelect(e,t,i)}),i.on("click","[data-box=fillList] li .colorPicker",function(){var i=$(this);i.parents(".form-row").eq(0).data("box");n._renderColorSelect(e,t,i)}),i.find(".control-panel").unbind("click").click(function(){var e=$(this),t=e.text();i.find(".form-row");"隐藏图层"==t?n._hide():n._show()}),i.unbind("click").click(function(){var e=i.find('[data-box="fillList"]');if(e.length>0&&"block"==e.css("display")){("block"==i.find('[data-box="fillSection"] .col_suspend').css("display")?1:0)+i.find(".f_select_on").length?e.find(".nice-scroll").getNiceScroll().hide():(e.find(".nice-scroll").getNiceScroll().show(),e.find(".nice-scroll").getNiceScroll().resize())}else e.find(".nice-scroll").getNiceScroll().hide()})},_renderColorSelect:function(e,t,n){var i=this,a=$(e),o=$.extend(!0,[],i.colors),l="",s=$(n).attr("value"),c=a.find(n).parent(),r=c.offset().left,d=c.offset().top;$(i.box).find('[data-box="fillSection"]').find(".col_suspend").hide(),$(i.box).find(".colorPicker").next(".col_suspend").remove();var l="",f="fillList"==$(n).parents(".form-row").eq(0).data("box")?"position:fixed;z-index:9999;left:"+(r+20)+"px;top:"+(d+16)+"px":"";l+='<div class="col_suspend" style="display:none;'+f+'">\n                        <div class="color-panel-container" style="background:'+s+';">\n                            <div class="minicolors-box"></div>\n                        </div>\n                        <div class="opacity-box" style="display:none;">\n                            <div class="opcity-bar">\n                                <div class="slider-dot" style="left:20%;"></div>\n                            </div>\n                        </div>\n                        <div class="current-color-box clearfix form-row p10">\n                            <div class="pull-left lh28 mr10">色值</div>\n                            <div class="form-input pull-left mr05" style="width:70px;"><input type="text" class="f_inpbox" value='+s+' disabled></div>\n                            <div class="current-color pull-left" style="background:'+s+'"></div>\n                            <div class="trans-color-box pull-right"></div>\n                        </div>\n                        <div class="color-list p10 single_color">\n                            <ul class="clearfix">',$.each(o,function(e,t){l+='<li class="" style="background:'+t+';"></li>'}),l+='</ul>\n                        </div>\n                        <div class="btbox clearfix text-center">\n                            <a href="javascript:;" class="mr10" type="confirm">确定</a>\n                            <a href="javascript:;" type="cancel">取消</a>\n                        </div>\n                    </div>',c.append(l),$.minicolors={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",defaultValue:"",hide:null,hideSpeed:100,inline:!1,letterCase:"lowercase",opacity:!1,position:"top left",show:null,showSpeed:100,theme:"default"}},a.find(".minicolors-box").minicolors({change:function(e,t){c.find(".f_inpbox").val(e).parent().next().css("background",e),c.find(".minicolors-swatch").hide(),c.find(".color-panel-container").css("background",e),c.find(".minicolors-input-swatch").css("background","none")}});var p=c.find(".colorPicker").eq(0).attr("value");c.find(".minicolors-swatch").css("border","none"),c.find(".color-panel-container").css("background",p),c.find(".minicolors-theme-default.minicolors").css("width","100%").css("height","100%"),c.find(".minicolors-input-swatch").css("width","100%").css("height","100%").css("left","0").css("margin","0").css("background","none"),c.find(".col_suspend").toggle(),i._selectColorEvent(e,t),$(i.box).parents(".nice-scroll").eq(0).getNiceScroll().resize(),console.log($(i.box).parents(".nice-scroll").eq(0))},_isSection:function(e){var t=this,n=$(t.container),i=n.find(".navtabbox01 a.on").attr("type"),a=(n.find("[data-box=sectionIndex]"),n.find("[data-box=classifyIndex]"),n.find("[data-box=radius]"),n.find("[data-box=colorBucket]"));if("polygon-choropleth"==i||"marker-choropleth"==i||"od"==i||"polyline-choropleth"==i)return t._getSectionFillColorData(),e&&e(),"sectionIndex";if("polygon-category"==i||"marker-category"==i||"polyline-category"==i)return t._getClassifyFillColorData(),e&&e(),"classifyIndex";if("marker-bubble"==i){var o=a=n.find(".navtabbox[name=fillMode]").find("a.on").attr("value");"single"==o?t._getMarkRangeData():"multi"==o&&(t._getColorBucketData(),t._getMarkRangeData()),t._getMarkRangeData(),e&&e()}else if("marker-heat"==i)t._getHeatData(),e&&e();else{if("polygon-grid"!=i)return e&&e(),"singleFill";t.getGridData(function(){e&&e()})}},_selectColorEvent:function(e,t){var n=this,i=$(e);i.find("[data-box=outline],[data-box=fillColor],[data-box=label],[data-box=fillList],[data-box=line],[data-box=marker]").find(".color-list li").unbind("click").click(function(){var e=$(this),t=e.parents(".col_suspend").eq(0),i=(t.prev(),e.css("background-color"));e.addClass("on").siblings().removeClass("on"),e.parents(".color-list").eq(0).siblings(".color-panel-container").css("background",i),i=n._switchColor(i),e.parents(".color-list").eq(0).siblings(".current-color-box").find(".f_inpbox").val(i).parent().next().css("background",i)}),i.find("[data-box=outline],[data-box=fillColor],[data-box=label],[data-box=fillList],[data-box=line],[data-box=marker]").find(".btbox a").unbind("click").click(function(){var e=$(this),t=(i.find(".navtabbox01 a.on").attr("type"),e.text(),e.parents(".col_suspend").eq(0)),a=t.prev(),o=e.parent().siblings(".current-color-box").find(".f_inpbox").val();if("confirm"==e.attr("type")){if(a.css("background",o).attr("value",o),"fillList"==e.parents(".form-row").eq(0).data("box")){var l=e.parents("li").attr("key"),s=n.opts.type,c="polygon"==s?"fillColor":"point"==s?"markerColor":"";n.callbackData.vizConfig.buckets&&n.callbackData.vizConfig.buckets[l]&&(n.callbackData.vizConfig.buckets[l][c]=o),n.callbackData.colorLegend&&n.callbackData.colorLegend[l]&&(n.callbackData.colorLegend[l].color=o)}else{var r=a.attr("name");r&&(n.callbackData.vizConfig[r]=o)}n._getData()}t.hide()}),i.find("[data-box=outline],[data-box=fillColor],[data-box=label],[data-box=fillList],[data-box=line],[data-box=marker]").find(".trans-color-box").unbind("click").click(function(){var e=$(this).parents(".form-row").eq(0).attr("data-box"),t=i.find(".navtabbox01 a.on").attr("type");"fillList"==e&&$.each(n[t].vizConfig.buckets,function(e,t){}),n._getData()})},_switchColor:function(e){if(-1==e.indexOf("#")){var t=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};e=e.split("(")[1],e=e.split(")")[0],e=e.split(","),e="#"+t(e[0])+t(e[1])+t(e[2])}return e},_linear:function(e){var t="linear-gradient(to right,";return $.each(e,function(n,i){t+=i+(n==e.length-1?"":",")}),t+=")"},_resizeData:function(){this.callbackData={vizConfig:{},colorLegend:null}},_getSectionData:function(e){var t=this,n=$(t.container).find(".navtabbox01 a.on").attr("type");t.callbackData={vizConfig:{},colorLegend:null},e&&"fillSection"==e&&"polygon-grid"==n?t.gridSectionColor(function(){t._getData()}):t._isSection(function(){t._getData()})},_getData:function(){var e=this,t=$(e.container),n=(e.opts,t.data("fill"),t.find(".navtabbox01 a.on").attr("type"),t.find(".navtabbox01 a.on").attr("type")),i=t.find("[name]");e.callbackData.vizConfig.type=n,$.each(i,function(t,n){if("block"==$(n).parents(".form-row").eq(0).css("display")&&"block"==$(n).css("display")){var i=$(n).attr("name"),a=$(n).attr("value");a=parseFloat(a)==a?Number(a):a,i&&(e.callbackData.vizConfig[i]=a)}}),e._callback()},_callback:function(){var e=this,t=$(e.container),n=t.find(".navtabbox01 a.on").attr("type"),i=e.callbackData.vizConfig.buckets;if(i&&i.length>0&&("polygon-category"==n||"polygon-choropleth"==n||"polygon-grid"==n)){var a=e.callbackData.vizConfig.fillOpacity;$.each(e.callbackData.vizConfig.buckets,function(e,t){t.fillOpacity=a}),e.callbackData.vizConfig.fillOpacity=0,e.callbackData.vizConfig.fillColor=e.opts.index.bottomColor}if("polygon-simple"==n&&e.opts.index.types.length>0){var o=t.find("[data-box=sectionIndex]").find(".form-input").attr("value");o=o||e.opts.index.types[0].value,e.callbackData.vizConfig.buckets=[{fillColor:"#ffffff",fillOpacity:0,value:"NAN"}],e.callbackData.vizConfig.fieldName=o,e.callbackData.vizConfig.type="polygon-category"}if("marker-heat"==n&&(e.callbackData.vizConfig.heatMaxOpacity=e.callbackData.vizConfig.markerOpacity,delete e.callbackData.vizConfig.markerOpacity,e.opts.data&&e.opts.data.length>0&&e.callbackData.vizConfig.weightField)){var l=e.callbackData.vizConfig.weightField,s=e.opts.data.sort(function(e,t){return t[l]-e[l]}),c=s[0][l];c&&(e.callbackData.vizConfig.heatTopValue=c)}var r=t.find(".control-panel").text();e.callbackData.isShow="隐藏图层"==r,e.opts.isCache&&window.localStorage.setItem("maplayer"+e.opts.id,JSON.stringify(e.callbackData.vizConfig)),"polygon-grid"==n?(e.callbackData.vizConfig.type="polygon-choropleth",e.opts.callback(e.callbackData)):"time"==n||"polyline-simple"==n||"marker-icon"==n||"marker-simple"==n?"function"==typeof e.opts.callback&&e.opts.callback(e.callbackData,e,!!(e.opts.data&&e.opts.data.length>0)):"function"==typeof e.opts.callback&&e.opts.data&&e.opts.callback(e.callbackData,e,!!(e.opts.data&&e.opts.data.length>0))},_select:function(e,t,n,i){var a=this,o=$.extend(!0,[],t),l=$(a.container);if(0==o.length)o=[{value:"",text:"无"}];else{if(!("object"==O(o[0]))){o=$.map(o,function(e){return{value:e,text:e}})}}e.empty(),e.CityMapControl("select",{data:o,valueColumn:"",textColumn:"",seleted:n||o[0].value,textformatter:function(e,t){},selectTextFormatter:function(e){},eventListener:{click:function(e,t){a._hideColorDom()},change:function(e,t){var n=$(t),i=n.parents(".form-input").eq(0),o=n.parents(".form-row").eq(0).data("box"),s=$(a.container).find(".navtabbox01 a.on").attr("type");i.attr("value",e.value),i.find(".sel_text").text(e.text),i.find(".form_select").attr("title",e.text);var c=i.attr("name");c&&e.value&&(a.callbackData.vizConfig[c]=e.value),a.flag&&("sectionIndex"==o||"sectionClassify"==o||"classifyIndex"==o||"fillSection"==o||"radius"==o||"fillBucket"==o?"fillOpacity"==c||"lineOpacity"==c||"markerOpacity"==c?a._getData():("polygon-choropleth"==s&&("default"==e.value?l.find("div[name=bucketCount]").hide().prev().hide():l.find("div[name=bucketCount]").show().prev().show()),a._getSectionData()):a._getData())}}})},_hideColorDom:function(){var e=this,t=$(e.box);t.find(".colorPicker").next(".col_suspend").hide(),t.find('[data-box="fillSection"]').find(".col_suspend").hide(),$(e.box).parent(".nice-scroll").getNiceScroll().resize()},_update:function(e,t){function n(e,n,a){e.CityMapControl("select",{data:n,valueColumn:"",textColumn:"",seleted:t||n[0].value,textformatter:function(e,t){},selectTextFormatter:function(e){},eventListener:{click:function(e,t){i._hideColorDom()},change:function(e,t){var n=$(t),o=n.parents(".form-input").eq(0);n.parents(".form-row").eq(0).data("box"),$(i.container).find(".navtabbox01 a.on").attr("type");o.attr("value",e.value),o.find(".sel_text").text(e.text),o.find(".form_select").attr("title",e.text),a&&a()}}})}var i=this,a=$(i.container),o=i.numberTypes,l=a.find("[data-box=sectionIndex] .form-input").eq(0),s=a.find("[data-box=radius] .form-input").eq(0),c=a.find("[data-box=colorBucket] .form-input").eq(0);if(i._initConfigTypes(),i.isUodate=0,o.length>0){if("polygon"==i.opts.type||"od"==i.opts.type){var r=!1;n(l,o,function(){r&&i._getSectionData()}),r=!0;var d=a.find(".panel-body").css("display");i._clickFirst(),"none"==d&&(a.find(".panel-body").hide(),a.find(".control-panel").text("显示图层"))}if("point"==i.opts.type){var f=!1;n(l,o,function(){f&&i._getSectionData()}),n(s,o,function(){f&&i._getSectionData()}),n(c,o,function(){f&&i._getSectionData()}),f=!0;var d=a.find(".panel-body").css("display");i._clickFirst(),"none"==d&&(a.find(".panel-body").hide(),a.find(".control-panel").text("显示图层"))}}else i._clickFirst()},_getNumberArray:function(e,t){var n=e,i=[];return $.isArray(n)&&n.length>0&&$.isArray(t)&&t.length>0?($.each(n,function(e,n){var a=t[0][n.value];parseFloat(a)==a&&i.push(n)}),i):[]},_hide:function(){var e=this,t=$(e.container),n=t.find(".navtabbox01 a.on").attr("type");e.opts.isShow=!1,t.find(".panel-body").hide(),t.find(".control-panel").text("显示图层"),t.find(".but-collap").addClass("fold"),"function"==typeof e.opts.listenShow&&e.opts.listenShow(!1,n),$(e.box).find(".nice-scroll").getNiceScroll().resize(),e._hideColorDom()},_show:function(){var e=this,t=$(e.container),n=t.find(".navtabbox01 a.on").attr("type");e.opts.isShow=!0,t.find(".panel-body").show(),t.find(".control-panel").text("隐藏图层"),t.find(".but-collap").removeClass("fold"),"function"==typeof e.opts.listenShow&&e.opts.listenShow(!0,n),$(e.box).find(".nice-scroll").getNiceScroll().resize(),e._hideColorDom()},_clickFirst:function(){var e=this,t=!0,n=$(e.container),i=n.find(".navtabbox01 a[name!=hide]");e.opts.type;i.length>0&&$.each(i,function(e,n){t&&($(n).hasClass("forbid")||($(n).click(),t=!1))})},_updateAll:function(e){function t(e,t){0!=e.length&&(e.empty(),e.CityMapControl("select",{data:t,valueColumn:"",textColumn:"",seleted:l||t[0].value,textformatter:function(e,t){},selectTextFormatter:function(e){},eventListener:{click:function(e,t){n._hideColorDom()},change:function(e,t){var a=$(t),o=a.parents(".form-input").eq(0),l=(a.parents(".form-row").eq(0).data("box"),$(n.container).find(".navtabbox01 a.on").attr("type"));o.attr("value",e.value),o.find(".sel_text").text(e.text),o.find(".form_select").attr("title",e.text),n.flag&&("polygon-choropleth"==l&&("default"==e.value?i.find("div[name=bucketCount]").hide().prev().hide():i.find("div[name=bucketCount]").show().prev().show()),n._getSectionData()),n.flag&&n.opts.eventListener&&n.opts.eventListener.changeIndex&&"function"==typeof n.opts.eventListener.changeIndex&&n.opts.eventListener.changeIndex(e,n.activeType)}}}))}var n=this,i=$(n.container),a=n.opts.type,o=n.types,l=e.fieldName,s=n.numberTypes;if(n._initConfigTypes(),0==s.length)return void n._clickFirst();if(n.flag=!1,"polygon"==a){var c=i.find('[data-box="sectionIndex"]').find(".form-input"),r=i.find('[data-box="classifyIndex"]').find(".form-input"),d=i.find('[data-box="sectionClassify"]').find(".form-input").eq(0);t(c,e.sectionIndex?e.sectionIndex:s),t(r,e.classifyIndex?e.classifyIndex:o);var f=n.opts.section.bucketTypeSet,p=n.opts.defaultBucket;p&&(3==f.length&&p.length>0&&(f.unshift({value:"default",text:"默认分段"}),t(d,f)),4==f.length&&0==p.length&&(f.shift(1),t(d,f)))}else if("point"==a){var u=i.find('[data-box="sectionIndex"]').find(".form-input"),h=i.find('[data-box="classifyIndex"]').find(".form-input"),v=i.find('[data-box="radius"]').eq(0).find(".form-input"),m=i.find('[data-box="colorBucket"]').eq(0).find(".form-input"),y=i.find('[data-box="heat"]').eq(0).find(".form-input");t(u,e.sectionIndex?e.sectionIndex:s),t(v,e.radius?e.radius:s),t(m,e.colorField?e.colorField:s),t(y,e.heat?e.heat:s),t(h,e.classifyIndex?e.classifyIndex:o)}else if("od"==a){var d=i.find('[data-box="sectionIndex"]').find(".form-input");t(d,s)}if(e.labelField){t(i.find(".form-input[name=labelField]"),e.labelField)}var b=i.find(".panel-body").css("display");n._clickFirst(),"none"==b&&(i.find(".panel-body").hide(),i.find(".control-panel").text("显示图层")),n.flag=!0},_listChangeIndex:function(e){var t=this;"function"==typeof t.opts.eventListener.changeIndex&&t.opts.eventListener.changeIndex(e)},_filterTypes:function(e,t){if(t){var n={};return $.each(e,function(e,n){var i=n.value;if(!n.dataType){var a=$.map(t,function(e){if(void 0!==e[i]&&""!==e[i])return e[i]});if(0==a.length)return;var o=a[0];parseFloat(o)==o?n.dataType=o%1!=0?"float":"int":n.dataType="string"}}),n.types=e,n.numberTypes=$.map(e,function(e){if("float"==e.dataType||"int"==e.dataType)return e}),n}return{types:e,numberTypes:[]}},_setParam:function(e,t){function n(){if(2==arguments.length){var e=arguments[0],t=arguments[1];i.param[e]&&i.param[e][t]&&(i.opts[e][t]=$.extend(!0,[],i.param[e][t]))}}var i=this;n("label","labelFieldSet"),n("section","fieldNameSet"),n("section","classifyIndexSet"),n("section","fillColorSet"),n("radius","fieldNameSet"),n("heat","weightFieldSet"),n("fill","fillColorSet")},_switchShow:function(e){var t=this,n=t.container;e.length>0&&$.each(e,function(e,t){n.find(".form-row[data-box="+t+"]").show()})}},k.prototype.set=function(e,t){var n=this;if($.isArray(e)){if(e.length>0){$(n.container).find("[data-box=label]").show(),n.opts.data=e;var i=n._filterTypes(n.types,e);n.types=i.types,n.numberTypes=i.numberTypes,n._update(e,t)}}else{e.data&&(n.opts.data=e.data),e.types&&(n.types=e.types),e.defaultBucket&&(n.opts.defaultBucket=e.defaultBucket);var i=n._filterTypes(e.types?e.types:n.types,e.data);n.types=i.types,n.numberTypes=i.numberTypes,n._updateAll(e)}},k.prototype.setGrid=function(e){var t=this,n=$(t.container),i=e.fieldName,a=n.find('[data-box="sectionIndex"]').find(".form-input");if(e.types){!function(e,n){0!=e.length&&(e.empty(),e.CityMapControl("select",{data:n,valueColumn:"",textColumn:"",seleted:i||n[0].value,textformatter:function(e,t){},selectTextFormatter:function(e){},eventListener:{click:function(e,n){t._hideColorDom()},change:function(e,n){var i=$(n),a=i.parents(".form-input").eq(0);a.attr("value",e.value),a.find(".sel_text").text(e.text),a.find(".form_select").attr("title",e.text),t._getSectionData()}}}))}(a,e.types)}else e.fieldName&&a.find("a[citymapcontrol-select-option-value="+e.fieldName+"]").click()},k.prototype.changeShow=function(e){var t=this;t.opts.isShow!=e&&(e?t._show():t._hide())},k.prototype.changeIndex=function(e,t){},x.prototype=new k,x.prototype.init=function(){var e=this,t=e.opts;e._renderContainerDom(e.container,t),e._bindPolygonEvent(),e._clickFirst(),e.opts.isShow||e._hide(),console.log(e.types),$(e.container).find(".nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"})},x.prototype._bindPolygonEvent=function(){var e=this,t=$(e.container);t.find(".navtabbox01 a").unbind("click").click(function(){if("显示面板"==t.find(".panel-head .control-panel").text()&&(e.isCallback=!1),!$(this).hasClass("forbid")){e._hideColorDom(),$(e.container).find(".nice-scroll").getNiceScroll().hide();var n=$(this),i=n.attr("type");switch(n.addClass("on").siblings().removeClass("on"),t.find(".form-row[name!=type_switch]").hide(),e._switchShow(["outline","label"]),i){case e.configType.polygon[0].type:e._switchShow(["sectionIndex","sectionClassify","fillSection"]);break;case e.configType.polygon[1].type:e._switchShow(["classifyIndex","fillList","fillSection"]);break;case e.configType.polygon[2].type:e._switchShow(["fillColor"]);break;case e.configType.polygon[3].type:e._switchShow(["sectionIndex","sectionClassify","fillSection"])}e.activeType=i,e._getSectionData(),t.find(".col_suspend").hide()}})},x.prototype.judgeGrid=function(e){var t=e.tabs||[],n=!1;return t.length>0&&$.each(t,function(e,t){"polygon-grid"==t&&(n=!0)}),n},x.prototype.val=function(){},C.prototype=new k,C.prototype.init=function(){var e=this,t=e.opts;e._renderContainerDom(e.container,t),e._bindPointEvent(),e._clickFirst(),e.opts.isShow||e._hide(),$(e.container).find(".nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"})},C.prototype._bindPointEvent=function(){var e=this,t=$(e.container);t.find(".navtabbox01 a").unbind("click").click(function(){var n=$(this),i=n.attr("type");if(!$(this).hasClass("forbid")){switch(e._hideColorDom(),n.addClass("on").siblings().removeClass("on"),t.find(".form-row[name!=type_switch]").hide(),t.find(".form-row[data-box=label]").show(),t.find(".hr-line").show(),i){case e.configType.point[0].type:t.find(".hr-line").hide();break;case e.configType.point[1].type:e._switchShow(["outline","marker"]),t.find(".form-input[name=markerSize]").show().prev().show();break;case e.configType.point[2].type:e._switchShow(["sectionIndex","sectionClassify","fillSection","outline"]);break;case e.configType.point[3].type:e._switchShow(["fillSection","classifyIndex","fillList","outline"]);break;case e.configType.point[4].type:e._switchShow(["outline","radius","fillMode"]),t.find(".form-input[name=markerSize]").hide().prev().hide(),"multi"==t.find(".form-row[data-box=fillMode] a.on").attr("value")?(e._switchShow(["colorBucket","fillSection"]),e._getColorBucketData()):(t.find(".form-row[data-box=marker]").show(),e._getMarkRangeData());break;case e.configType.point[5].type:t.find(".form-row[data-box=label]").hide(),e._switchShow(["fillSection","heat"]),t.find(".hr-line").hide()}e.activeType=i,e._getSectionData(),t.find(".col_suspend").hide()}})},C.prototype.val=function(){},S.prototype=new k,S.prototype.init=function(){var e=this,t=e.opts;e._renderContainerDom(e.container,t),e._bindLineEvent(),e._clickFirst(),e.opts.isShow||e._hide(),$(e.container).find(".nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"})},S.prototype._bindLineEvent=function(){var e=this,t=$(e.container);t.find(".navtabbox01 a").unbind("click").click(function(){var n=$(this),i=n.attr("type");if(!$(this).hasClass("forbid")){switch(e._hideColorDom(),n.addClass("on").siblings().removeClass("on"),t.find(".form-row[name!=type_switch]").hide(),t.find(".form-row[data-box=label]").show(),i){case e.configType.line[0].type:t.find(".form-row[data-box=line]").show();break;case e.configType.line[1].type:e._switchShow(["fillSection","sectionIndex","sectionClassify"]);break;case e.configType.line[2].type:e._switchShow(["classifyIndex","fillList","fillSection"])}e.activeType=i,e._getSectionData(),t.find(".col_suspend").hide()}})},S.prototype.val=function(){},_.prototype=new k,_.prototype.init=function(){var e=this,t=e.opts;e._renderContainerDom(e.container,t),e._bindODEvent(),e._clickFirst(),e.opts.isShow||e._hide(),$(e.container).find(".nice-scroll").niceScroll({styler:"fb",cursorcolor:"#D6DBDF",cursorwidth:"5",cursorborderradius:"10px",background:"#EEF7FF",spacebarenabled:!1,cursorborder:"0",zindex:"1000"})},_.prototype._bindODEvent=function(){var e=this,t=$(e.container);t.find(".navtabbox01 a").unbind("click").click(function(){var n=$(this),i=n.attr("type");if(!$(this).hasClass("forbid")){switch(e._hideColorDom(),n.addClass("on").siblings().removeClass("on"),t.find(".form-row[name!=type_switch]").hide(),e.opts.index.data&&t.find(".form-row[data-box=label]").show(),i){case e.configType.od[0].type:e._switchShow(["line","od","sectionIndex","sectionClassify","fillSection"])}e.activeType=i,e._getSectionData(),t.find(".col_suspend").hide()}})},w.prototype=new k,w.prototype.init=function(){var e=this,t=e.opts;e._renderContainerDom(e.container,t),e._bindODEvent(),e._clickFirst(),e.opts.isShow||e._hide()},w.prototype._bindODEvent=function(){var e=this,t=$(e.container);t.find(".navtabbox01 a").unbind("click").click(function(){var n=$(this),i=n.attr("type");if(!$(this).hasClass("forbid")){switch(e._hideColorDom(),n.addClass("on").siblings().removeClass("on"),t.find(".form-row[name!=type_switch]").hide(),i){case e.configType.time[0].type:t.find(".form-row[data-box=time]").show()}e.activeType=i,e._getSectionData(),t.find(".col_suspend").hide(),t.find(".hr-line").hide()}})},_.prototype.val=function(){},D.prototype.init=function(e){var t=this,n=t.container;n.empty(),t.layer={},$.each(e,function(e,i){i.id&&i.type?"point"==i.type?t.layer[i.id]=new C(i,n):"polygon"==i.type?t.layer[i.id]=new x(i,n):"line"==i.type?t.layer[i.id]=new S(i,n):"od"==i.type?t.layer[i.id]=new _(i,n):"time"==i.type&&(t.layer[i.id]=new w(i,n)):console.log("缺少id或type属性")})},D.prototype.add=function(e){var t=this,n=e,i=t.container;"point"==n.type?t.layer[n.id]=new C(n,i):"polygon"==n.type?t.layer[n.id]=new x(n,i):"line"==n.type?t.layer[n.id]=new S(n,i):"od"==n.type?t.layer[n.id]=new _(n,i):"time"==n.type&&(t.layer[n.id]=new w(n,i))},D.prototype.remove=function(e){e?this.container.find("#"+e).length>0&&(this.layer[e]&&delete this.layer[e],$("#"+e).remove()):(this.layer={},this.container.empty())},D.prototype.val=function(){},D.prototype.getLayer=function(e){return this.layer[e]},L.prototype={_bindEvent:function(){var e=this,t=e.container;t.find(".switch-map li").unbind("click").click(function(t){var n=$(this),i=n.data("mapconfig-maptype"),a=n.data("mapconfig-mapstyle");n.addClass("on").siblings().removeClass("on"),e.mapType=i,e.mapStyle=a,e._mapsRun(),"function"==typeof e.eventListener.mapTypeChange&&e.eventListener.mapTypeChange(i,a),t.stopPropagation()}),t.find("[data-mapconfig-pitch]").unbind("click").click(function(t){var n=$(this),i=parseInt(n.data("mapconfig-pitch"));n.addClass("on").siblings().removeClass("on"),e.gMaps.length>0&&$.each(e.gMaps,function(e,t){t.setPitch(i)})})},_mapsRun:function(){var e=this;e.gMaps.length>0&&$.each(e.gMaps,function(t,n){n.setMapType(cityGMap.mapType[e.mapType],cityGMap.mapStyle[e.mapStyle]||"")})}},L.prototype.init=function(){this._bindEvent()},L.prototype.setMap=function(e){var t=this;t.gMaps=e,t._mapsRun()},L.prototype.removeMap=function(e){var t=this;t.gMaps.splice(t.gMaps.indexOf(e),1),t.gMaps.length>0&&t._mapsRun()},L.prototype.clearMap=function(){this.gMaps=[]},L.prototype.setMapType=function(e,t){var n=this;t?$.each(n.config,function(e,t){n.mapType==t.mapType&&n.mapStyle==t.mapStyle&&n.container.find(".switch-map li").eq(e).click()}):$.each(n.config,function(e,t){n.mapType==t.mapType&&n.container.find(".switch-map li").eq(e).click()})},L.prototype.on=function(e,t){var n=this;e&&(n.eventListener[e]=t)},L.prototype.off=function(e){var t=this;e&&delete t.eventListener[e]},L.prototype.getMapType=function(){var e=this;return{mapType:e.mapType,mapStyle:e.mapStyle}};var U={};U.select=s,U.multiselect=c,U.table=r,U.districtArea=u,U.districtAreaStd=h,U.legend=y,U.poiTypeSelect=m,U.mapVisualization=D,U.mapType=L,$.fn.CityMapControl=function(e,t){var n=U[e];if(n){var i=new n(this,t);this.data("citymap-control-"+e,i)}},$.fn.GetCityMapControl=function(e){return this.data("citymap-control-"+e)},$.cityMapControl={getLegendSectionData:g,loadingDistrictData:p,loadingTypeSelectData:v,legendFun:P},e.exports.loadingDistrictData=p,e.exports.getLegendSectionData=g,e.exports.loadingTypeSelectData=v,e.exports.legendFun=P}])});